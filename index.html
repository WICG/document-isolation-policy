<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Document-Isolation-Policy</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version b25686b9f, updated Fri Mar 14 14:15:20 2025 -0700" name="generator">
  <link href="https://github.com/WICG/document-isolation-policy" rel="canonical">
  <meta content="f9df6f2168f65516a463006e7320447280bbbef6" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
.monkey-patch {
    padding: .5em;
    border: thin solid #ddd;
    border: thin solid 1px;
    border-radius: .5em;
    margin: .5em calc(-0.5em - 1px);
    background-color: rgba(255, 255, 0, 0.03);
    backdrop-filter: blur(5px);
    box-shadow: 0px 5px 5px 0px rgba(0, 0, 0, 0.05);
}

.brief {
  line-height: 10%;
}

.customHighlight {
  padding-top:9px ;
  padding-bottom:9px ;
  background-color: rgba(255,255,0,0.3)
}

</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <h1 class="p-name no-ref" id="title">Document-Isolation-Policy</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2025-04-23">23 April 2025</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://github.com/WICG/document-isolation-policy">https://github.com/WICG/document-isolation-policy</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/document-isolation-policy/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:clamy@google.com">Camille Lamy</a> (<span class="p-org org">Google</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright">©2024, Google, Inc. All rights reserved.</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This proposal explores a new header, "Document-Isolation-Policy", that
enables crossOriginIsolation for the document, without relying on COOP and
COEP. In turns, this gives access to COI-gated APIs such as SharedArrayBuffers.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#recommended-readings"><span class="secno">1.1</span> <span class="content">Recommended readings</span></a>
     </ol>
    <li>
     <a href="#dip-html"><span class="secno">2</span> <span class="content">Integration with HMTL</span></a>
     <ol class="toc">
      <li>
       <a href="#dip-supporting-concepts"><span class="secno">2.1</span> <span class="content">Supporting concepts when loading web pages</span></a>
       <ol class="toc">
        <li>
         <a href="#dip"><span class="secno">2.1.1</span> <span class="content">Cross-origin-opener-policies</span></a>
         <ol class="toc">
          <li><a href="#dip-bcg-switch"><span class="secno">2.1.1.1</span> <span class="content">Browsing context group switches due to cross-origin opener policy</span></a>
         </ol>
        <li>
         <a href="#dip-dip"><span class="secno">2.1.2</span> <span class="content">Document Isolation Policies</span></a>
         <ol class="toc">
          <li><a href="#dip-headers"><span class="secno">2.1.2.1</span> <span class="content">The headers</span></a>
         </ol>
        <li><a href="#dip-policy-containers"><span class="secno">2.1.3</span> <span class="content">Policy containers</span></a>
       </ol>
      <li>
       <a href="#dip-browsing-contexts"><span class="secno">2.2</span> <span class="content">Browsing contexts</span></a>
       <ol class="toc">
        <li><a href="#dip-bc"><span class="secno">2.2.1</span> <span class="content">Browsing contexts</span></a>
        <li><a href="#dip-grouping-of-browsing-contexts"><span class="secno">2.2.2</span> <span class="content">Grouping of browsing contexts</span></a>
       </ol>
      <li>
       <a href="#dip-document-lifecycle"><span class="secno">2.3</span> <span class="content">Document lifecycle</span></a>
       <ol class="toc">
        <li><a href="#dip-document-creation"><span class="secno">2.3.1</span> <span class="content">Shared document creation infrastructure</span></a>
       </ol>
      <li><a href="#dip-agent-clusters"><span class="secno">2.4</span> <span class="content">Agents and agent clusters</span></a>
     </ol>
    <li>
     <a href="#dip-fetch"><span class="secno">3</span> <span class="content">Integration with Fetch</span></a>
     <ol class="toc">
      <li><a href="#dip-requests"><span class="secno">3.1</span> <span class="content">Requests</span></a>
      <li><a href="#dip-corp"><span class="secno">3.2</span> <span class="content">'Cross-Origin-Resource-Policy' header</span></a>
      <li><a href="#dip-http-fetch"><span class="secno">3.3</span> <span class="content">HTTP-network-or-cache fetch</span></a>
     </ol>
    <li><a href="#dip-security"><span class="secno">4</span> <span class="content">Security considerations</span></a>
    <li><a href="#dip-privacy"><span class="secno">5</span> <span class="content">Privacy considerations</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p><em>This section is not normative.</em></p>
   <h3 class="heading settled" data-level="1.1" id="recommended-readings"><span class="secno">1.1. </span><span class="content">Recommended readings</span><a class="self-link" href="#recommended-readings"></a></h3>
   <ul>
    <li data-md>
     <p>The <a data-link-type="biblio" href="#biblio-explainer" title="Document-Isolation-Policy explainer">[explainer]</a> for Document-Isolation-Policy.</p>
    <li data-md>
     <p>The <a data-link-type="biblio" href="#biblio-spectre" title="Spectre Attacks: Exploiting Speculative Execution">[Spectre]</a> vulnerability.</p>
    <li data-md>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies">Cross-Origin-Opener-Policy</a> (<a data-link-type="dfn" data-refhint-key="776ed7cb" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies①">COOP</a>) section of the HTML spec.</p>
    <li data-md>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coep" id="ref-for-coep">Cross-Origin-Embedder-Policy</a> (<a data-link-type="dfn" data-refhint-key="fb08834f" href="https://html.spec.whatwg.org/C/#coep" id="ref-for-coep①">COEP</a>) section of the HTML spec.</p>
    <li data-md>
     <p>How and why <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies②">Cross-Origin-Opener-Policy</a> (<a data-link-type="dfn" data-refhint-key="776ed7cb" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies③">COOP</a>) and <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coep" id="ref-for-coep②">Cross-Origin-Embedder-Policy</a> (<a data-link-type="dfn" data-refhint-key="fb08834f" href="https://html.spec.whatwg.org/C/#coep" id="ref-for-coep③">COEP</a>) are granting the <a href="concept-settings-object-cross-origin-isolated-capability">crossOriginIsolated</a> capability. See <a data-link-type="biblio" href="#biblio-whycoopcoep" title="Why you need &quot;cross-origin isolated&quot; for powerful features">[WhyCoopCoep]</a>.</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="dip-html"><span class="secno">2. </span><span class="content">Integration with HMTL</span><a class="self-link" href="#dip-html"></a></h2>
   <p>This section defines a monkey-patch over <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>.</p>
   <h3 class="heading settled" data-level="2.1" id="dip-supporting-concepts"><span class="secno">2.1. </span><span class="content">Supporting concepts when loading web pages</span><a class="self-link" href="#dip-supporting-concepts"></a></h3>
   <h4 class="heading settled" data-level="2.1.1" id="dip"><span class="secno">2.1.1. </span><span class="content">Cross-origin-opener-policies</span><a class="self-link" href="#dip"></a></h4>
   <p>Modify the definition of "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep">same-origin-plus-coep</a>":</p>
   <div class="monkey-patch">
    <p>This behaves the same as "same-origin", with the addition that it sets the
(new) <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group">group</a>’s <a data-link-type="dfn" href="#bcg-coi-key" id="ref-for-bcg-coi-key">agent cluster cross-origin isolation key</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation">cross-origin isolation mode</a> to one of "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-isolation-logical" id="ref-for-cross-origin-isolation-logical">logical</a>" or "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-isolation-concrete" id="ref-for-cross-origin-isolation-concrete">concrete</a>".</p>
   </div>
   <h5 class="heading settled" data-level="2.1.1.1" id="dip-bcg-switch"><span class="secno">2.1.1.1. </span><span class="content">Browsing context group switches due to cross-origin opener policy</span><a class="self-link" href="#dip-bcg-switch"></a></h5>
   <p>Modify step 4 of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#obtain-browsing-context-navigation" id="ref-for-obtain-browsing-context-navigation">obtain a browsing context to use for a navigation response</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="4">
     <li data-md>
      <p>If <em>navigationCOOP</em>'s value is "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep①">same-origin-plus-COEP</a>", then:</p>
      <ol>
       <li data-md>
        <p>Let <em>crossOriginIsolationMode</em> be either "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-isolation-logical" id="ref-for-cross-origin-isolation-logical①">logical</a>" or "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-isolation-concrete" id="ref-for-cross-origin-isolation-concrete①">concrete</a>".
 The choice of which is implementation-defined.</p>
       <li data-md>
        <p>Set <em>newBrowsingContext</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group①">group</a>’s <a data-link-type="dfn" href="#bcg-coi-key" id="ref-for-bcg-coi-key①">agent cluster cross-origin isolation key</a> to
 {<em>coopEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin">origin</a>, <em>crossOriginIsolationMode</em>}.</p>
      </ol>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.1.2" id="dip-dip"><span class="secno">2.1.2. </span><span class="content">Document Isolation Policies</span><a class="self-link" href="#dip-dip"></a></h4>
   <p>Add a new subsection to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#loading-web-pages-supporting-concepts" id="ref-for-loading-web-pages-supporting-concepts">loading web pages supporting concepts</a> section
of the HTML spec.</p>
   <div class="monkey-patch">
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-value" data-noexport id="dip-value">document isolation policy value</dfn> is one of three
strings that controls <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters" id="ref-for-sec-agent-clusters">agent cluster</a> allocation and the fetching of
cross-origin resources without explicit permission from resource owners.</p>
    <ul>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-none" data-noexport id="dip-none">none</dfn>":
This is the default value. When this value is used, cross-origin resources
can be fetched without giving explicit permission through the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-protocol" id="ref-for-cors-protocol">CORS protocol</a> or the '<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy" id="ref-for-http-cross-origin-resource-policy">Cross-Origin-Resource-Policy</a>' header. The document is
assigned to a non cross-origin isolated <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters" id="ref-for-sec-agent-clusters①">agent cluster</a>.</p>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-isolate-and-require-corp" data-noexport id="dip-isolate-and-require-corp">isolate-and-require-corp</dfn>":
When this value is used, fetching cross-origin resources requires the
server’s explicit permission through the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-protocol" id="ref-for-cors-protocol①">CORS protocol</a> or the
'<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy" id="ref-for-http-cross-origin-resource-policy①">Cross-Origin-Resource-Policy</a>' header. The document is also assigned to a
cross-origin isolated <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters" id="ref-for-sec-agent-clusters②">agent cluster</a>.</p>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-isolate-and-credentialless" data-noexport id="dip-isolate-and-credentialless">isolate-and-credentialless</dfn>":
When this value is used, fetching cross-origin no-CORS resources omits
credentials. In exchange, an explicit '<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy" id="ref-for-http-cross-origin-resource-policy②">Cross-Origin-Resource-Policy</a>'
header is not required. Other requests sent with credentials require the
server’s explicit permission through the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cors-protocol" id="ref-for-cors-protocol②">CORS protocol</a> or the
'<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy" id="ref-for-http-cross-origin-resource-policy③">Cross-Origin-Resource-Policy</a>' header. The document is also assigned to a
cross-origin isolated <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters" id="ref-for-sec-agent-clusters③">agent cluster</a>.</p>
    </ul>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-struct" data-noexport id="dip-struct">document isolation policy</dfn> consists of:</p>
    <ul>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-struct-value" data-noexport id="dip-struct-value">value</dfn>, which is a <a data-link-type="dfn" href="#dip-value" id="ref-for-dip-value">document
isolation policy value</a>, initially "<a data-link-type="dfn" href="#dip-none" id="ref-for-dip-none">none</a>.</p>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-reporting-endpoint" data-noexport id="dip-reporting-endpoint">reporting endpoint</dfn>, initially the
empty string.</p>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-report-only-value" data-noexport id="dip-report-only-value">report-only value</dfn>, which is a <a data-link-type="dfn" href="#dip-value" id="ref-for-dip-value①">document
isolation policy value</a>, initially "<a data-link-type="dfn" href="#dip-none" id="ref-for-dip-none①">none</a>.</p>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-report-only-endpoint" data-noexport id="dip-report-only-endpoint">report-only reporting endpoint</dfn>,
initially the empty string.</p>
    </ul>
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="obtain-coi-key" data-noexport id="obtain-coi-key">obtain a cross-origin agent cluster isolation
key</dfn> given null or a <a data-link-type="dfn" href="#dip-struct" id="ref-for-dip-struct">document isolation policy</a> <em>documentIsolationPolicy</em> and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin①">origin</a> <em>origin</em>:</p>
    <ol>
     <li data-md>
      <p>If <em>documentIsolationPolicy</em> is null, return null.</p>
     <li data-md>
      <p>If <em>documentIsolationPolicy</em>'s <a data-link-type="dfn" href="#dip-struct-value" id="ref-for-dip-struct-value">value</a> is
 "<a data-link-type="dfn" href="#dip-none" id="ref-for-dip-none②">none</a>", then return null.</p>
     <li data-md>
      <p>Let <em>crossOriginIsolationMode</em> be either "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-isolation-logical" id="ref-for-cross-origin-isolation-logical②">logical</a>" or "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-isolation-concrete" id="ref-for-cross-origin-isolation-concrete②">concrete</a>".
 The choice of which is implementation-defined.</p>
     <li data-md>
      <p>Let <em>crossOriginIsolationKey</em> be a new <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key">agent cluster
 cross-origin isolation key</a>.</p>
     <li data-md>
      <p>Set <em>crossOriginIsolationKey</em> to {<em>origin</em>, <em>crossOriginIsolationMode</em>}.</p>
     <li data-md>
      <p>Return <em>crossOriginIsolationKey</em>.</p>
    </ol>
    <h5 class="heading settled" data-level="2.1.2.1" id="dip-headers"><span class="secno">2.1.2.1. </span><span class="content">The headers</span><a class="self-link" href="#dip-headers"></a></h5>
    <p>The '<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-header" data-noexport id="dip-header">Document-Isolation-Policy</dfn>' and
'<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="dip-report-only-header" data-noexport id="dip-report-only-header">Document-Isolation-Policy-Report-Only</dfn>'
HTTP response headers allow a server to declare a <a data-link-type="dfn" href="#dip-struct" id="ref-for-dip-struct①">document isolation
policy</a> for a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#clone-a-node-document" id="ref-for-clone-a-node-document">document</a>. These headers are <a data-link-type="dfn" href="https://httpwg.org/specs/rfc8941.html#specify" id="ref-for-specify">structured headers</a> whose values
must be <a data-link-type="dfn" href="https://httpwg.org/specs/rfc8941.html#token" id="ref-for-token">token</a>.</p>
    <p>The valid <a data-link-type="dfn" href="https://httpwg.org/specs/rfc8941.html#token" id="ref-for-token①">token</a> values are the <a data-link-type="dfn" href="#dip-value" id="ref-for-dip-value②">document isolation policy
values</a>. The token may also have attached <a data-link-type="dfn" href="https://mimesniff.spec.whatwg.org/#parameters" id="ref-for-parameters">parameters</a>; of these, the
"report-to" parameter can have a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#valid-url-string" id="ref-for-valid-url-string">valid URL string</a> identifying an
appropriate reporting endpoint.</p>
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="obtain-dip" data-noexport id="obtain-dip">obtain a document isolation policy</dfn> given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> <em>response</em> and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#environment" id="ref-for-environment">environment</a> <em>environment</em>:</p>
    <ol>
     <li data-md>
      <p>Let <em>policy</em> be a new <a data-link-type="dfn" href="#dip-struct" id="ref-for-dip-struct②">document isolation policy</a>.</p>
     <li data-md>
      <p>If <em>environment</em> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context" id="ref-for-non-secure-context">non-secure context</a>, then return <em>policy</em>.</p>
     <li data-md>
      <p>Let <em>parsedItem</em> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" id="ref-for-concept-header-list-get-structured-header">getting a structured field value</a> with <code>Document-Isolation-Policy</code> and "item" from <em>response</em>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a>.</p>
     <li data-md>
      <p>If <em>parsedItem</em> is non-null:</p>
      <ol>
       <li data-md>
        <p>If <em>parsedItem</em>[0] is
  "<a data-link-type="dfn" href="#dip-isolate-and-require-corp" id="ref-for-dip-isolate-and-require-corp">isolate-and-require-corp</a>" or
  "<a data-link-type="dfn" href="#dip-isolate-and-credentialless" id="ref-for-dip-isolate-and-credentialless">isolate-and-credentialless</a>", set <em>policy</em>'s <a data-link-type="dfn" href="#dip-struct-value" id="ref-for-dip-struct-value①">value</a> to <em>parsedItem</em>[0].</p>
       <li data-md>
        <p>If <em>parsedItem</em>[1]["report-to"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">exists</a>, then set <em>policy</em>'s <a data-link-type="dfn" href="#dip-reporting-endpoint" id="ref-for-dip-reporting-endpoint">reporting endpoint</a> to <em>parsedItem</em>[1]["report-to"].</p>
      </ol>
     <li data-md>
      <p>Set <em>parsedItem</em> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" id="ref-for-concept-header-list-get-structured-header①">getting a structured field value</a> with <code>Document-Isolation-Policyi-Report-Only</code> and "item" from <em>response</em>'s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list①">header list</a>.</p>
     <li data-md>
      <p>If <em>parsedItem</em> is non-null:</p>
      <ol>
       <li data-md>
        <p>If <em>parsedItem</em>[0] is
  "<a data-link-type="dfn" href="#dip-isolate-and-require-corp" id="ref-for-dip-isolate-and-require-corp①">isolate-and-require-corp</a>" or
  "<a data-link-type="dfn" href="#dip-isolate-and-credentialless" id="ref-for-dip-isolate-and-credentialless①">isolate-and-credentialless</a>", set <em>policy</em>'s <a data-link-type="dfn" href="#dip-report-only-value" id="ref-for-dip-report-only-value">report-only value</a> to <em>parsedItem</em>[0].</p>
       <li data-md>
        <p>If <em>parsedItem</em>[1]["report-to"] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">exists</a>, then set <em>policy</em>'s <a data-link-type="dfn" href="#dip-report-only-endpoint" id="ref-for-dip-report-only-endpoint">report-only reporting endpoint</a> to <em>parsedItem</em>[1]["report-to"].</p>
      </ol>
     <li data-md>
      <p>Return policy.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.1.3" id="dip-policy-containers"><span class="secno">2.1.3. </span><span class="content">Policy containers</span><a class="self-link" href="#dip-policy-containers"></a></h4>
   <p>Add the following members to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container">policy container</a> struct:</p>
   <div class="monkey-patch">
    <ul>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="policy-container-dip" data-noexport id="policy-container-dip">document isolation policy</dfn>, which is a <a data-link-type="dfn" href="#dip-struct" id="ref-for-dip-struct③">document isolation policy</a>. It is initially a new <a data-link-type="dfn" href="#dip-struct" id="ref-for-dip-struct④">document isolation policy</a>.</p>
     <li data-md>
      <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="policy-container-coi-key" data-noexport id="policy-container-coi-key">agent cluster cross-origin isolation
key</dfn>, which is null or an <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key①">agent cluster
cross-origin isolation key</a>. It is initially null. This <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key②">agent cluster cross-origin isolation key</a> is based
on the <a data-link-type="dfn" href="#dip-struct" id="ref-for-dip-struct⑤">document isolation policy</a> of the document. It overrides the <a data-link-type="dfn" href="#bcg-coi-key" id="ref-for-bcg-coi-key②">agent cluster cross-origin isolation key</a> stored in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group②">browsing context group</a>.</p>
    </ul>
   </div>
   <p>Add step 5 and 6 to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#clone-a-policy-container" id="ref-for-clone-a-policy-container">clone a policy container</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="5">
     <li data-md>
      <p>Set <em>clone</em>'s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip">document isolation policy</a> to a copy
 of <em>policyContainer</em>'s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip①">document isolation policy</a>.</p>
     <li data-md>
      <p>Set <em>clone</em>'s <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key">agent cluster cross-origin
 isolation key</a> to a copy of <em>policyContainer</em>'s <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key①">agent cluster cross-origin isolation key</a>.</p>
    </ol>
   </div>
   <p>Add step 6 and 7 to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#creating-a-policy-container-from-a-fetch-response" id="ref-for-creating-a-policy-container-from-a-fetch-response">create a policy container from a fetch response</a>:</p>
   <div class="monkey-patch">
    <ol start="6">
     <li data-md>
      <p>If <em>environment</em> is non-null, then set <em>result</em>'s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip②">document isolation policy</a> to the result of <a data-link-type="dfn" href="#obtain-dip" id="ref-for-obtain-dip">obatining a document isolation policy</a> given <em>response</em> and <em>environment</em>.</p>
     <li data-md>
      <p>Set <em>result</em>'s <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key②">agent cluster cross-origin
 isolation key</a> to the result of <a data-link-type="dfn" href="#obtain-coi-key" id="ref-for-obtain-coi-key">obtaining a cross-origin
 isolation key</a> given <em>result</em>'s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip③">document isolation
 policy</a> and <em>response</em>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin②">origin</a>.</p>
    </ol>
   </div>
   <p>Add step 3 to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#initialize-worker-policy-container" id="ref-for-initialize-worker-policy-container">initialize a worker global scope’s policy container</a>:</p>
   <div class="monkey-patch">
    <ol start="3">
     <li data-md>
      <p>If <em>workerGlobalScope</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set" id="ref-for-concept-WorkerGlobalScope-owner-set">owner set</a>’s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> is 1, then:</p>
      <ol>
       <li data-md>
        <p>Set <em>workerGlobalScope</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container①">policy container</a>’s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip④">document isolation policy</a> to <em>workerGlobalScope</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set" id="ref-for-concept-WorkerGlobalScope-owner-set①">owner set</a>[0]'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container②">policy container</a>’s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip⑤">document isolation policy</a>.</p>
       <li data-md>
        <p>Set <em>workerGlobalScope</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container③">policy container</a>’s <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key③">agent cluster cross-origin
  isolation key</a> to <em>workerGlobalScope</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set" id="ref-for-concept-WorkerGlobalScope-owner-set②">owner set</a>[0]'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object①">relevant settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container④">policy container</a>’s <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key④">agent cluster cross-origin isolation key</a>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="2.2" id="dip-browsing-contexts"><span class="secno">2.2. </span><span class="content">Browsing contexts</span><a class="self-link" href="#dip-browsing-contexts"></a></h3>
   <h4 class="heading settled" data-level="2.2.1" id="dip-bc"><span class="secno">2.2.1. </span><span class="content">Browsing contexts</span><a class="self-link" href="#dip-bc"></a></h4>
   <div class="monkey-patch">
    <p>Add a step 5 to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#creating-a-new-browsing-context" id="ref-for-creating-a-new-browsing-context">create a new browsing context and document</a> algorithm:</p>
    <ol start="5">
     <li data-md>
      <p>Let <em>creatorAgentClusterCOIKey</em> be null.</p>
    </ol>
   </div>
   <p>Add a step 5.4 to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#creating-a-new-browsing-context" id="ref-for-creating-a-new-browsing-context①">create a new browsing context and document</a> algorithm:</p>
   <div class="monkey-patch">
    <p>5.4 Set <em>creatorAgentClusterCOIKey</em> to <em>creator</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container⑤">policy container</a>’s <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key⑤">agent cluster cross-origin isolation key</a>.</p>
   </div>
   <p>Modify step 9 of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#creating-a-new-browsing-context" id="ref-for-creating-a-new-browsing-context②">create a new browsing context and document</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="9">
     <li data-md>
      <p>Let <em>agent</em> be the result of obtaining a similar-origin window agent given <em>origin</em>, <em>group</em>, false, and <em>creatorAgentClusterCOIKey</em>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="2.2.2" id="dip-grouping-of-browsing-contexts"><span class="secno">2.2.2. </span><span class="content">Grouping of browsing contexts</span><a class="self-link" href="#dip-grouping-of-browsing-contexts"></a></h4>
   <p>Remove the following line:</p>
   <div class="monkey-patch">
    <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group③">browsing context group</a> has a cross-origin isolation mode, which is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation①">cross-origin isolation mode</a>. It is initially "none".</p>
   </div>
   <p>Add the following line:</p>
   <div class="monkey-patch">
    <p>A <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group④">browsing context group</a> has an <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="bcg-coi-key" data-noexport id="bcg-coi-key">agent cluster
cross-origin isolation key</dfn>, which is null or an <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key③">agent cluster cross-origin isolation key</a> . It is
initially null. It is set by <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies④">Cross-Origin-Opener-Policy</a>, and is the default <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key④">agent cluster cross-origin isolation key</a> for
documents inside the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group⑤">browsing context group</a>. However, it can be overriden by the <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key⑥">policy container’s agent cluster cross-origin
isolation key</a> when a document has a <a data-link-type="dfn" href="#dip-struct" id="ref-for-dip-struct⑥">document isolation policy</a>.</p>
   </div>
   <h3 class="heading settled" data-level="2.3" id="dip-document-lifecycle"><span class="secno">2.3. </span><span class="content">Document lifecycle</span><a class="self-link" href="#dip-document-lifecycle"></a></h3>
   <h4 class="heading settled" data-level="2.3.1" id="dip-document-creation"><span class="secno">2.3.1. </span><span class="content">Shared document creation infrastructure</span><a class="self-link" href="#dip-document-creation"></a></h4>
   <p>Modify step 8.4 of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#initialise-the-document-object" id="ref-for-initialise-the-document-object">create and initialize a Document object</a> algorithm:</p>
   <div class="monkey-patch">
    <p>Let <em>agent</em> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent" id="ref-for-obtain-similar-origin-window-agent">obtaining a similar-origin window agent</a> given <em>navigationParams</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin③">origin</a>, <em>browsingContext</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group⑥">group</a>, <em>requestsOAC</em>, and <em>navigationParams</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container⑥">policy container</a>’s <a data-link-type="dfn" href="#policy-container-coi-key" id="ref-for-policy-container-coi-key⑦">agent cluster cross-origin isolation key</a>.</p>
   </div>
   <h3 class="heading settled" data-level="2.4" id="dip-agent-clusters"><span class="secno">2.4. </span><span class="content">Agents and agent clusters</span><a class="self-link" href="#dip-agent-clusters"></a></h3>
   <p>Add the following to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#integration-with-the-javascript-agent-cluster-formalism" id="ref-for-integration-with-the-javascript-agent-cluster-formalism">Integration with the JavaScript agent cluster formalism</a>:</p>
   <div class="monkey-patch">
    <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coi-agent-cluster-key" data-noexport id="coi-agent-cluster-key">agent cluster cross-origin isolation
key</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin④">origin</a> and a <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation②">cross-origin isolation mode</a>.</p>
   </div>
   <p>Change the definition of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#agent-cluster-key" id="ref-for-agent-cluster-key">agent cluster key</a>:</p>
   <div class="monkey-patch">
    <p>An <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#agent-cluster-key" id="ref-for-agent-cluster-key①">agent cluster key</a> is either a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site">site</a>, or a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple" id="ref-for-concept-origin-tuple">tuple origin</a>, or a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">tuple</a> of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple" id="ref-for-concept-origin-tuple①">tuple origin</a> and an <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key⑤">agent cluster
cross-origin isolation key</a>.</p>
   </div>
   <p>Modify the <a data-link-type="dfn" data-refhint-key="4fcd5676" href="https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent" id="ref-for-obtain-similar-origin-window-agent①">obtain a similar-origin window agent</a> algorithm definition:</p>
   <div class="monkey-patch">
    <p>To <a data-link-type="dfn" data-refhint-key="4fcd5676" href="https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent" id="ref-for-obtain-similar-origin-window-agent②">obtain a similar-origin window agent</a>, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑤">origin</a> <em>origin</em>, a <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group⑦">browsing context group</a> <em>group</em>, a boolean <em>requestsOAC</em>, and null or an <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key⑥">agent cluster cross-origin isolation key</a> <em>agentClusterCOIKey</em>, run these steps:</p>
   </div>
   <p>Modify step 3 of the <a data-link-type="dfn" data-refhint-key="4fcd5676" href="https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent" id="ref-for-obtain-similar-origin-window-agent③">obtain a similar-origin window agent</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="3">
     <li data-md>
      <p>If <em>agentClusterCOIKey</em> is not <em>null</em>, then set <em>key</em> to {<em>origin</em>, <em>agentClusterCOIKey</em>}.</p>
     <li data-md>
      <p>Otherwise, if <em>group’s</em> <a data-link-type="dfn" href="#bcg-coi-key" id="ref-for-bcg-coi-key③">agent cluster cross-origin isolation
 key</a> is not <em>null</em>, then set <em>key</em> to {<em>origin</em>, <em>group’s</em> <a data-link-type="dfn">agent
 cluster cross-origin isolation key</a>}.</p>
    </ol>
   </div>
   <p>Modify steps 6.2 and 6.3 of the <a data-link-type="dfn" data-refhint-key="4fcd5676" href="https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent" id="ref-for-obtain-similar-origin-window-agent④">obtain a similar-origin window agent</a> algorithm:</p>
   <div class="monkey-patch">
    <p>6.2 If <em>key</em> has an <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key⑦">agent cluster cross-origin
isolation key</a>, set <em>agentCluster</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation③">cross-origin isolation mode</a> to <em>key</em>'s <a data-link-type="dfn" href="#coi-agent-cluster-key" id="ref-for-coi-agent-cluster-key⑧">agent cluster cross-origin isolation key</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation④">cross-origin isolation mode</a>.</p>
    <p>6.3 Set <em>agentCluster</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#is-origin-keyed" id="ref-for-is-origin-keyed">is origin-keyed</a> to false if <em>key</em> equals <em>site</em>; otherwise true.</p>
   </div>
   <h2 class="heading settled" data-level="3" id="dip-fetch"><span class="secno">3. </span><span class="content">Integration with Fetch</span><a class="self-link" href="#dip-fetch"></a></h2>
   <p>This section defines a monkey-patch over <a data-link-type="biblio" href="#biblio-fetch" title="Fetch Standard">[Fetch]</a>.</p>
   <h3 class="heading settled" data-level="3.1" id="dip-requests"><span class="secno">3.1. </span><span class="content">Requests</span><a class="self-link" href="#dip-requests"></a></h3>
   <p>Add a new algorithm to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request">Requests</a> part of Fetch:</p>
   <div class="monkey-patch">
    <p>To check if <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-isolation-policy-allows-credentials">Document-Isolation-Policy allows credentials</dfn>, given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-request" id="ref-for-concept-request-request①">request</a> <em>request</em>, run these steps:</p>
    <ol>
     <li data-md>
      <p>If <em>request</em>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode">mode</a> is not "no-cors", then return true.</p>
     <li data-md>
      <p>If <em>request</em>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a> is null, then return true.</p>
     <li data-md>
      <p>If <em>request</em>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client①">client</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container⑦">policy container</a>’s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip⑥">document-isolation-policy</a>’s <a data-link-type="dfn" href="#dip-value" id="ref-for-dip-value③">value</a> is not
 "<a data-link-type="dfn" href="#dip-isolate-and-credentialless" id="ref-for-dip-isolate-and-credentialless②">isolate-and-credentialless</a>", then return true.</p>
     <li data-md>
      <p>If <em>request</em>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑥">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#same-origin" id="ref-for-same-origin">same origin</a> with <em>request</em>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-current-url" id="ref-for-concept-request-current-url">current URL</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑦">origin</a> and <em>request</em> does not have a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-tainted-origin" id="ref-for-concept-request-tainted-origin">redirect-tainted origin</a>,
 then return true.</p>
     <li data-md>
      <p>Return false.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.2" id="dip-corp"><span class="secno">3.2. </span><span class="content">'Cross-Origin-Resource-Policy' header</span><a class="self-link" href="#dip-corp"></a></h3>
   <p>Add a new enum definition to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy" id="ref-for-http-cross-origin-resource-policy④">Cross-Origin-Resource-Policy</a> section of Fetch:</p>
   <div class="monkey-patch">
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="corp-check-result" data-noexport id="corp-check-result">cross-origin resource policy internal check result</dfn> is one of five values:</p>
    <ul>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="corp-check-allowed" data-noexport id="corp-check-allowed">allowed</dfn>"</p>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="corp-check-blocked" data-noexport id="corp-check-blocked">blocked</dfn>"</p>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="corp-check-blocked-coep" data-noexport id="corp-check-blocked-coep">blocked-by-coep</dfn>"</p>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="corp-check-blocked-dip" data-noexport id="corp-check-blocked-dip">blocked-by-dip</dfn>"</p>
     <li data-md>
      <p>"<dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="corp-check-blocked-coep-dip" data-noexport id="corp-check-blocked-coep-dip">blocked-by-coep-and-dip</dfn>"</p>
    </ul>
   </div>
   <p>Modify the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check" id="ref-for-cross-origin-resource-policy-check">cross-origin resource policy check</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="4">
     <li data-md>
      <p>Let <em>documentIsolationPolicy</em> be <em>settingsObject</em>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container⑧">policy container</a>’s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip⑦">document-isolation-policy</a>.</p>
     <li data-md>
      <p>Let <em>reportOnlyCheck</em> be the the result of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check" id="ref-for-cross-origin-resource-policy-internal-check">cross-origin resource policy internal check</a> with <em>origin</em>, <em>embedderPolicy</em>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#embedder-policy-report-only-value" id="ref-for-embedder-policy-report-only-value">report only value</a>, <em>documentIsolationPolicy</em>’s <a data-link-type="dfn" href="#dip-report-only-value" id="ref-for-dip-report-only-value①">report only value</a>, <em>response</em>, and <em>forNavigation</em>.</p>
     <li data-md>
      <p>If <em>reportOnlyCheck</em> is "<a data-link-type="dfn" href="#corp-check-blocked-coep" id="ref-for-corp-check-blocked-coep">blocked-by-coep</a>" or
 "<a data-link-type="dfn" href="#corp-check-blocked-coep-dip" id="ref-for-corp-check-blocked-coep-dip">blocked-by-coep-and-dip</a>", then <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report" id="ref-for-queue-a-cross-origin-embedder-policy-corp-violation-report">queue a cross-origin embedder policy CORP violation report</a> with <em>response</em>, <em>settingsObject</em>, <em>destination</em>, and true.</p>
     <li data-md>
      <p>If <em>reportOnlyCheck</em> is "<a data-link-type="dfn" href="#corp-check-blocked-dip" id="ref-for-corp-check-blocked-dip">blocked-by-dip</a>" or
 "<a data-link-type="dfn" href="#corp-check-blocked-coep-dip" id="ref-for-corp-check-blocked-coep-dip①">blocked-by-coep-and-dip</a>", then <a data-link-type="dfn" href="#queue-a-document-isolation-policy-corp-violation-report" id="ref-for-queue-a-document-isolation-policy-corp-violation-report">queue a document isolation policy CORP violation report</a> with <em>response</em>, <em>settingsObject</em>, <em>destination</em>, and true.</p>
     <li data-md>
      <p>Let <em>check</em> be the the result of the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check" id="ref-for-cross-origin-resource-policy-internal-check①">cross-origin resource policy internal check</a> with <em>origin</em>, <em>embedderPolicy</em>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#embedder-policy-value-2" id="ref-for-embedder-policy-value-2">value</a>, <em>documentIsolationPolicy</em>’s <a data-link-type="dfn" href="#dip-struct-value" id="ref-for-dip-struct-value②">report value</a>, <em>response</em>, and <em>forNavigation</em>.</p>
     <li data-md>
      <p>If <em>check</em> is "<a data-link-type="dfn" href="#corp-check-allowed" id="ref-for-corp-check-allowed">allowed</a>", then return <strong>allowed</strong>.</p>
     <li data-md>
      <p>If <em>check</em> is "<a data-link-type="dfn" href="#corp-check-blocked-coep" id="ref-for-corp-check-blocked-coep①">blocked-by-coep</a>" or
  "<a data-link-type="dfn" href="#corp-check-blocked-coep-dip" id="ref-for-corp-check-blocked-coep-dip②">blocked-by-coep-and-dip</a>", then <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report" id="ref-for-queue-a-cross-origin-embedder-policy-corp-violation-report①">queue a cross-origin embedder policy CORP violation report</a> with <em>response</em>, <em>settingsObject</em>, <em>destination</em>, and false.</p>
     <li data-md>
      <p>If <em>reportOnlyCheck</em> is "<a data-link-type="dfn" href="#corp-check-blocked-dip" id="ref-for-corp-check-blocked-dip①">blocked-by-dip</a>" or
  "<a data-link-type="dfn" href="#corp-check-blocked-coep-dip" id="ref-for-corp-check-blocked-coep-dip③">blocked-by-coep-and-dip</a>", then <a data-link-type="dfn" href="#queue-a-document-isolation-policy-corp-violation-report" id="ref-for-queue-a-document-isolation-policy-corp-violation-report①">queue a document isolation policy CORP violation report</a> with <em>response</em>, <em>settingsObject</em>, <em>destination</em>, and false.</p>
     <li data-md>
      <p>Return <strong>blocked</strong>.</p>
    </ol>
   </div>
   <p>Modify the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check" id="ref-for-cross-origin-resource-policy-internal-check②">cross-origin resource policy internal check</a> algorithm definition:</p>
   <div class="monkey-patch">
    <p>To perform a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check" id="ref-for-cross-origin-resource-policy-internal-check③">cross-origin resource policy internal check</a>, given an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑧">origin</a> <em>origin</em>, an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-value" id="ref-for-embedder-policy-value">embedder policy value</a> <em>embedderPolicyValue</em>, a <a data-link-type="dfn" href="#dip-value" id="ref-for-dip-value④">document isolation policy value</a> <em>documentIsolationPolicyValue</em>, a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a> <em>response</em>, and a boolean <em>forNavigation</em>, run these steps:</p>
   </div>
   <p>Modify the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check" id="ref-for-cross-origin-resource-policy-internal-check④">cross-origin resource policy internal check</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="4">
     <li data-md>
      <p>Let <em>checkResult</em> be a <a data-link-type="dfn" href="#corp-check-result" id="ref-for-corp-check-result">cross-origin resource policy
 internal check result</a> with value "<a data-link-type="dfn" href="#corp-check-blocked" id="ref-for-corp-check-blocked">blocked</a>".</p>
     <li data-md>
      <p>If <em>policy</em> is null, then:</p>
      <ol>
       <li data-md>
        <p>Let <em>upgradeDueToCOEP</em> be false.</p>
       <li data-md>
        <p>Let <em>upgradeDueToDIP</em> be false.</p>
       <li data-md>
        <p>Switch on <em>embedderPolicyValue</em>:</p>
        <ul>
         <li data-md>
          <p>"<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coep-unsafe-none" id="ref-for-coep-unsafe-none">unsafe-none</a>"</p>
          <ol>
           <li data-md>
            <p>Do nothing.</p>
          </ol>
         <li data-md>
          <p>"<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coep-credentialless" id="ref-for-coep-credentialless">credentialless</a>"</p>
          <ol>
           <li data-md>
            <p>Set <em>upgradeDueToCOEP</em> to true if:</p>
            <ul>
             <li data-md>
              <p><em>response</em>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#response-request-includes-credentials" id="ref-for-response-request-includes-credentials">request-includes-credentials</a> is true, or</p>
             <li data-md>
              <p><em>forNavigation</em> is true.</p>
            </ul>
          </ol>
         <li data-md>
          <p>"<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coep-require-corp" id="ref-for-coep-require-corp">require-corp</a>"</p>
          <ol>
           <li data-md>
            <p>Set <em>upgradeDueToCOEP</em> to true.</p>
          </ol>
        </ul>
       <li data-md>
        <p>Switch on <em>documentIsolationPolicyValue</em>:</p>
        <ul>
         <li data-md>
          <p>"<a data-link-type="dfn" href="#dip-none" id="ref-for-dip-none③">dip-none</a>"</p>
          <ol>
           <li data-md>
            <p>Do nothing.</p>
          </ol>
         <li data-md>
          <p>"<a data-link-type="dfn" href="#dip-isolate-and-credentialless" id="ref-for-dip-isolate-and-credentialless③">isolate-and-credentialless</a>"</p>
          <ol>
           <li data-md>
            <p>Set <em>upgradeDueToDIP</em> to true if <em>response</em>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#response-request-includes-credentials" id="ref-for-response-request-includes-credentials①">request-includes-credentials</a> is true.</p>
          </ol>
         <li data-md>
          <p>"<a data-link-type="dfn" href="#dip-isolate-and-require-corp" id="ref-for-dip-isolate-and-require-corp②">isolate-and-require-corp</a>"</p>
          <ol>
           <li data-md>
            <p>Set <em>upgradeDueToDIP</em> to true.</p>
          </ol>
        </ul>
       <li data-md>
        <p>If <em>upgradeDueToCOEP</em> or <em>upgradeDueToDIP</em> is true, set <em>policy</em> to
  'same-origin'.</p>
       <li data-md>
        <p>If <em>upgradeDueToCOEP</em> is true, then:</p>
        <ol>
         <li data-md>
          <p>If <em>upgradeDueToDIP</em> is true, then set <em>checkResult</em> to
 "<a data-link-type="dfn" href="#corp-check-blocked-coep-dip" id="ref-for-corp-check-blocked-coep-dip④">blocked-by-coep-and-dip</a>".</p>
         <li data-md>
          <p>Otherwise, set <em>checkResult</em> to
 "<a data-link-type="dfn" href="#corp-check-blocked" id="ref-for-corp-check-blocked①">blocked-by-coep</a>".</p>
        </ol>
       <li data-md>
        <p>Otherwise, if <em>upgradeDueToDIP</em> is true, then set <em>checkResult</em> to
     "<a data-link-type="dfn" href="#corp-check-blocked-dip" id="ref-for-corp-check-blocked-dip②">blocked-by-dip</a>".</p>
      </ol>
     <li data-md>
      <p>Switch on <em>policy</em>:</p>
      <ul>
       <li data-md>
        <p>null</p>
       <li data-md>
        <p><code>cross-origin</code></p>
        <ol>
         <li data-md>
          <p>Set <em>checkResult</em> to "<a data-link-type="dfn" href="#corp-check-allowed" id="ref-for-corp-check-allowed①">allowed</a>".</p>
        </ol>
       <li data-md>
        <p><code>same-origin</code></p>
        <ol>
         <li data-md>
          <p>If <em>origin</em> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#same-origin" id="ref-for-same-origin①">same origin</a> with <em>response</em>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑨">origin</a>,
  then set <em>checkResult</em> to "<a data-link-type="dfn" href="#corp-check-allowed" id="ref-for-corp-check-allowed②">allowed</a>".</p>
        </ol>
       <li data-md>
        <p><code>same-site</code></p>
        <ol>
         <li data-md>
          <p>If all of the following are true</p>
          <ul>
           <li data-md>
            <p><em>origin</em> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#schemelessly-same-site" id="ref-for-schemelessly-same-site">schemelessly same site</a> with <em>response</em>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URL</a>’s <em>origin</em></p>
           <li data-md>
            <p><em>origin</em>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is "https" or <em>response</em>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">URL</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is not "https"</p>
          </ul>
         <li data-md>
          <p>then set <em>checkResult</em> to "<a data-link-type="dfn" href="#corp-check-allowed" id="ref-for-corp-check-allowed③">allowed</a>".</p>
        </ol>
      </ul>
     <li data-md>
      <p>Return <em>checkResult</em>.</p>
    </ol>
   </div>
   <p>Add a new algorithm to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy" id="ref-for-http-cross-origin-resource-policy⑤">Cross-Origin-Resource-Policy</a> section of Fetch:</p>
   <div class="monkey-patch">
    <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="queue-a-document-isolation-policy-corp-violation-report">queue a document isolation policy CORP violation report</dfn>, given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response②">response</a> <em>response</em>, an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" id="ref-for-environment-settings-object">environment settings object</a> <em>settingsObject</em>, a
string <em>destination</em>, and a boolean <em>reportOnly</em>, run these steps:</p>
    <ol>
     <li data-md>
      <p>Let <em>endpoint</em> be <em>settingsObject</em>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container⑨">policy container</a>’s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip⑧">document-isolation-policy</a>’s <a data-link-type="dfn" href="#dip-report-only-endpoint" id="ref-for-dip-report-only-endpoint①">report only reporting endpoint</a> if <em>reportOnly</em> is true and <em>settingsObject</em>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#policy-container" id="ref-for-policy-container①⓪">policy container</a>’s <a data-link-type="dfn" href="#policy-container-dip" id="ref-for-policy-container-dip⑨">document-isolation-policy</a>’s <a data-link-type="dfn" href="#dip-reporting-endpoint" id="ref-for-dip-reporting-endpoint①">reporting endpoint</a> otherwise.</p>
     <li data-md>
      <p>Let <em>serializedURL</em> be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#serialize-a-response-url-for-reporting" id="ref-for-serialize-a-response-url-for-reporting">serializing a response URL for reporting</a> with <em>response</em>.</p>
     <li data-md>
      <p>Let <em>disposition</em> be "reporting" if reportOnly is true; otherwise "enforce".</p>
     <li data-md>
      <p>Let <em>body</em> be a new object containing the following properties:</p>
      <table class="def">
       <tbody>
        <tr>
         <th>"type"
         <td>"corp" 
        <tr>
         <th>"blockedURL"
         <td>serializedURL 
        <tr>
         <th>"destination"
         <td>destination 
        <tr>
         <th>"disposition"
         <td>disposition 
      </table>
     <li data-md>
      <p><a data-link-type="dfn" href="https://w3c.github.io/reporting/#generate-and-queue-a-report" id="ref-for-generate-and-queue-a-report">Generate and queue a report</a> for <em>settingsObject</em>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global" id="ref-for-concept-settings-object-global">global object</a> given the "dip", <em>endpoint</em>, and <em>body</em>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="dip-http-fetch"><span class="secno">3.3. </span><span class="content">HTTP-network-or-cache fetch</span><a class="self-link" href="#dip-http-fetch"></a></h3>
   <p>Add a step 8.5 to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch" id="ref-for-concept-http-network-or-cache-fetch">HTTP-network-or-cache fetch</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="5">
     <li data-md>
      <p>If <a data-link-type="dfn" href="#document-isolation-policy-allows-credentials" id="ref-for-document-isolation-policy-allows-credentials">Document-Isolation-Policy allows credentials</a> with <em>request</em> returns
 false, then set <em>includeCredentials</em> to false.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="4" id="dip-security"><span class="secno">4. </span><span class="content">Security considerations</span><a class="self-link" href="#dip-security"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Document-Isolation-Policy is a security API whose goal is to give access to
potentially dangerous APIs (like Shared Array Buffers) in a safe manner. In
order to do so, Document-Isolation-Policy relies on the user agent backing the
agent cluster separation with effective process separation. If the user agent
is not able to do so (e.g. it cannot support Out-of-Process Iframes), the user
agent should set a cross-origin isolation mode of "logical" for documents with
Document-Isolation-Policy. This will prevent the document from getting access
to the dangerous APIs gated behind cross-origin isolation.</p>
   <p>This choice of cross-origin isolation mode should be a static choice made for
all origins on a user’s machine, to avoid leaking the state of other documents on
the user’s machine.</p>
   <p>For a longer discussion of the threat model this API adresses, please refer to
the <a data-link-type="biblio" href="#biblio-explainer" title="Document-Isolation-Policy explainer">[explainer]</a>.</p>
   <h2 class="heading settled" data-level="5" id="dip-privacy"><span class="secno">5. </span><span class="content">Privacy considerations</span><a class="self-link" href="#dip-privacy"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>No additional privacy concerns beyond the risks mentionned in the security
considerations section.</p>
  </main>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#bcg-coi-key">bcg-coi-key</a><span>, in § 2.2.2</span>
   <li><a href="#coi-agent-cluster-key">coi-agent-cluster-key</a><span>, in § 2.4</span>
   <li><a href="#corp-check-allowed">corp-check-allowed</a><span>, in § 3.2</span>
   <li><a href="#corp-check-blocked">corp-check-blocked</a><span>, in § 3.2</span>
   <li><a href="#corp-check-blocked-coep">corp-check-blocked-coep</a><span>, in § 3.2</span>
   <li><a href="#corp-check-blocked-coep-dip">corp-check-blocked-coep-dip</a><span>, in § 3.2</span>
   <li><a href="#corp-check-blocked-dip">corp-check-blocked-dip</a><span>, in § 3.2</span>
   <li><a href="#corp-check-result">corp-check-result</a><span>, in § 3.2</span>
   <li><a href="#dip-header">dip-header</a><span>, in § 2.1.2.1</span>
   <li><a href="#dip-isolate-and-credentialless">dip-isolate-and-credentialless</a><span>, in § 2.1.2</span>
   <li><a href="#dip-isolate-and-require-corp">dip-isolate-and-require-corp</a><span>, in § 2.1.2</span>
   <li><a href="#dip-none">dip-none</a><span>, in § 2.1.2</span>
   <li><a href="#dip-reporting-endpoint">dip-reporting-endpoint</a><span>, in § 2.1.2</span>
   <li><a href="#dip-report-only-endpoint">dip-report-only-endpoint</a><span>, in § 2.1.2</span>
   <li><a href="#dip-report-only-header">dip-report-only-header</a><span>, in § 2.1.2.1</span>
   <li><a href="#dip-report-only-value">dip-report-only-value</a><span>, in § 2.1.2</span>
   <li><a href="#dip-struct">dip-struct</a><span>, in § 2.1.2</span>
   <li><a href="#dip-struct-value">dip-struct-value</a><span>, in § 2.1.2</span>
   <li><a href="#dip-value">dip-value</a><span>, in § 2.1.2</span>
   <li><a href="#document-isolation-policy-allows-credentials">Document-Isolation-Policy allows credentials</a><span>, in § 3.1</span>
   <li><a href="#obtain-coi-key">obtain-coi-key</a><span>, in § 2.1.2</span>
   <li><a href="#obtain-dip">obtain-dip</a><span>, in § 2.1.2.1</span>
   <li><a href="#policy-container-coi-key">policy-container-coi-key</a><span>, in § 2.1.3</span>
   <li><a href="#policy-container-dip">policy-container-dip</a><span>, in § 2.1.3</span>
   <li><a href="#queue-a-document-isolation-policy-corp-violation-report">queue a document isolation policy CORP violation report</a><span>, in § 3.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a84c14c9">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="fa5c4242">agent cluster</span>
    </ul>
   <li>
    <a data-link-type="biblio">[Fetch]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="857d5516">client</span>
     <li><span class="dfn-paneled" id="a2a30ba8">CORS protocol</span>
     <li><span class="dfn-paneled" id="2aaa937f">cross-origin resource policy check</span>
     <li><span class="dfn-paneled" id="ae07036e">cross-origin resource policy internal check</span>
     <li><span class="dfn-paneled" id="7e8a44f1">cross-origin-resource-policy</span>
     <li><span class="dfn-paneled" id="3f2ca4de">current URL</span>
     <li><span class="dfn-paneled" id="5c66de35">get a structured field value</span>
     <li><span class="dfn-paneled" id="f7b00a8b">header list</span>
     <li><span class="dfn-paneled" id="980528b0">http-network-or-cache fetch</span>
     <li><span class="dfn-paneled" id="cb98f71f">mode</span>
     <li><span class="dfn-paneled" id="8cb360fb">queue a cross-origin embedder policy corp violation report</span>
     <li><span class="dfn-paneled" id="c329eb66">redirect-tainted origin</span>
     <li><span class="dfn-paneled" id="162d2b51">request</span>
     <li><span class="dfn-paneled" id="76e370a7">request-includes-credentials</span>
     <li><span class="dfn-paneled" id="ee7bba09">response</span>
     <li><span class="dfn-paneled" id="aab97826">serialize a response URL for reporting</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3fa2961f">agent cluster key</span>
     <li><span class="dfn-paneled" id="c8c92a09">browsing context group</span>
     <li><span class="dfn-paneled" id="00c57527">clone a policy container</span>
     <li><span class="dfn-paneled" id="d8813cef">COEP</span>
     <li><span class="dfn-paneled" id="9995e764">coep-credentialless</span>
     <li><span class="dfn-paneled" id="ec8f27f1">coep-require-corp</span>
     <li><span class="dfn-paneled" id="0f044324">coep-unsafe-none</span>
     <li><span class="dfn-paneled" id="16258447">concrete</span>
     <li><span class="dfn-paneled" id="e3892898">COOP</span>
     <li><span class="dfn-paneled" id="2f018f5f">create a new browsing context and document</span>
     <li><span class="dfn-paneled" id="ce1c0037">create and initialize a document object</span>
     <li><span class="dfn-paneled" id="cfb6031b">creating a policy container from a fetch response</span>
     <li><span class="dfn-paneled" id="2a9c82c5">cross-origin isolation mode</span>
     <li><span class="dfn-paneled" id="047398fc">Cross-Origin-Embedder-Policy</span>
     <li><span class="dfn-paneled" id="20d23287">Cross-Origin-Opener-Policy</span>
     <li><span class="dfn-paneled" id="4338c067">embedder policy value</span>
     <li><span class="dfn-paneled" id="d5ce1200">embedder-policy-report-only-value</span>
     <li><span class="dfn-paneled" id="b998573a">embedder-policy-value-2</span>
     <li><span class="dfn-paneled" id="77a2dc1b">environment</span>
     <li><span class="dfn-paneled" id="3e12e042">environment settings object</span>
     <li><span class="dfn-paneled" id="8a30477b">global object</span>
     <li><span class="dfn-paneled" id="5ed8aeef">initialize a worker global scope's policy container</span>
     <li><span class="dfn-paneled" id="f58ae318">Integration with the JavaScript agent cluster formalism</span>
     <li><span class="dfn-paneled" id="33549c7a">is origin-keyed</span>
     <li><span class="dfn-paneled" id="ee4df7df">loading web pages supporting concepts</span>
     <li><span class="dfn-paneled" id="6dc08662">logical</span>
     <li><span class="dfn-paneled" id="5155c2d3">non-secure context</span>
     <li><span class="dfn-paneled" id="c56b026c">obtain a browsing context to use for a navigation response</span>
     <li><span class="dfn-paneled" id="76cf46eb">obtain a similar-origin window agent</span>
     <li><span class="dfn-paneled" id="98cfc8b6">obtaining a similar-origin window agent</span>
     <li><span class="dfn-paneled" id="3124aef9">origin</span>
     <li><span class="dfn-paneled" id="dc248371">owner set</span>
     <li><span class="dfn-paneled" id="0741b07e">policy container</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="f26905b5">same origin</span>
     <li><span class="dfn-paneled" id="8af97c1e">same-origin-plus-coep</span>
     <li><span class="dfn-paneled" id="0757a962">schemelessly same site</span>
     <li><span class="dfn-paneled" id="fb9bb722">site</span>
     <li><span class="dfn-paneled" id="c2fcb960">top-level browsing context</span>
     <li><span class="dfn-paneled" id="1d2aa117">tuple origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e2eac3f1">list-size</span>
     <li><span class="dfn-paneled" id="33a77dff">map-exists</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MIMESNIFF]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="fc5a3214">parameters</span>
    </ul>
   <li>
    <a data-link-type="biblio">[REPORTING-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="7ed9d314">generate and queue a report</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STRUCTURED-FIELDS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="f9433a40">structured headers</span>
     <li><span class="dfn-paneled" id="04dc11d2">token</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3a711be7">scheme</span>
     <li><span class="dfn-paneled" id="dcffbccd">URL</span>
     <li><span class="dfn-paneled" id="05af0c3f">valid URL string</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-fetch">[Fetch]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-mimesniff">[MIMESNIFF]
   <dd>Gordon P. Hemsley. <a href="https://mimesniff.spec.whatwg.org/"><cite>MIME Sniffing Standard</cite></a>. Living Standard. URL: <a href="https://mimesniff.spec.whatwg.org/">https://mimesniff.spec.whatwg.org/</a>
   <dt id="biblio-reporting-1">[REPORTING-1]
   <dd>Douglas Creager; Ian Clelland; Mike West. <a href="https://w3c.github.io/reporting/"><cite>Reporting API</cite></a>. URL: <a href="https://w3c.github.io/reporting/">https://w3c.github.io/reporting/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-explainer">[EXPLAINER]
   <dd>Camille Lamy. <a href="https://github.com/WICG/document-isolation-policy"><cite>Document-Isolation-Policy explainer</cite></a>. URL: <a href="https://github.com/WICG/document-isolation-policy">https://github.com/WICG/document-isolation-policy</a>
   <dt id="biblio-spectre">[Spectre]
   <dd>Paul Kocher; et al. <a href="https://spectreattack.com/spectre.pdf"><cite>Spectre Attacks: Exploiting Speculative Execution</cite></a>. URL: <a href="https://spectreattack.com/spectre.pdf">https://spectreattack.com/spectre.pdf</a>
   <dt id="biblio-whycoopcoep">[WhyCoopCoep]
   <dd>Eiji Kitamura; Demenic Denicola. <a href="https://web.dev/why-coop-coep/"><cite>Why you need "cross-origin isolated" for powerful features</cite></a>. URL: <a href="https://web.dev/why-coop-coep/">https://web.dev/why-coop-coep/</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"00c57527": {"dfnID":"00c57527","dfnText":"clone a policy container","external":true,"refSections":[{"refs":[{"id":"ref-for-clone-a-policy-container"}],"title":"2.1.3. Policy containers"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#clone-a-policy-container"},
"047398fc": {"dfnID":"047398fc","dfnText":"Cross-Origin-Embedder-Policy","external":true,"refSections":[{"refs":[{"id":"ref-for-coep"},{"id":"ref-for-coep\u2460"},{"id":"ref-for-coep\u2461"},{"id":"ref-for-coep\u2462"}],"title":"1.1. Recommended readings"}],"url":"https://html.spec.whatwg.org/C/#coep"},
"04dc11d2": {"dfnID":"04dc11d2","dfnText":"token","external":true,"refSections":[{"refs":[{"id":"ref-for-token"},{"id":"ref-for-token\u2460"}],"title":"2.1.2.1. The headers"}],"url":"https://httpwg.org/specs/rfc8941.html#token"},
"05af0c3f": {"dfnID":"05af0c3f","dfnText":"valid URL string","external":true,"refSections":[{"refs":[{"id":"ref-for-valid-url-string"}],"title":"2.1.2.1. The headers"}],"url":"https://url.spec.whatwg.org/#valid-url-string"},
"0741b07e": {"dfnID":"0741b07e","dfnText":"policy container","external":true,"refSections":[{"refs":[{"id":"ref-for-policy-container"},{"id":"ref-for-policy-container\u2460"},{"id":"ref-for-policy-container\u2461"},{"id":"ref-for-policy-container\u2462"},{"id":"ref-for-policy-container\u2463"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-policy-container\u2464"}],"title":"2.2.1. Browsing contexts"},{"refs":[{"id":"ref-for-policy-container\u2465"}],"title":"2.3.1. Shared document creation infrastructure"},{"refs":[{"id":"ref-for-policy-container\u2466"}],"title":"3.1. Requests"},{"refs":[{"id":"ref-for-policy-container\u2467"},{"id":"ref-for-policy-container\u2468"},{"id":"ref-for-policy-container\u2460\u24ea"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#policy-container"},
"0757a962": {"dfnID":"0757a962","dfnText":"schemelessly same site","external":true,"refSections":[{"refs":[{"id":"ref-for-schemelessly-same-site"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#schemelessly-same-site"},
"0e8de730": {"dfnID":"0e8de730","dfnText":"tuple","external":true,"refSections":[{"refs":[{"id":"ref-for-tuple"},{"id":"ref-for-tuple\u2460"}],"title":"2.4. Agents and agent clusters"}],"url":"https://infra.spec.whatwg.org/#tuple"},
"0f044324": {"dfnID":"0f044324","dfnText":"coep-unsafe-none","external":true,"refSections":[{"refs":[{"id":"ref-for-coep-unsafe-none"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#coep-unsafe-none"},
"16258447": {"dfnID":"16258447","dfnText":"concrete","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-origin-isolation-concrete"}],"title":"2.1.1. Cross-origin-opener-policies"},{"refs":[{"id":"ref-for-cross-origin-isolation-concrete\u2460"}],"title":"2.1.1.1. Browsing context group switches due to cross-origin opener policy"},{"refs":[{"id":"ref-for-cross-origin-isolation-concrete\u2461"}],"title":"2.1.2. Document Isolation Policies"}],"url":"https://html.spec.whatwg.org/C/#cross-origin-isolation-concrete"},
"162d2b51": {"dfnID":"162d2b51","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-request"},{"id":"ref-for-concept-request-request\u2460"}],"title":"3.1. Requests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-request"},
"1d2aa117": {"dfnID":"1d2aa117","dfnText":"tuple origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-tuple"},{"id":"ref-for-concept-origin-tuple\u2460"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple"},
"20d23287": {"dfnID":"20d23287","dfnText":"Cross-Origin-Opener-Policy","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-origin-opener-policies"},{"id":"ref-for-cross-origin-opener-policies\u2460"},{"id":"ref-for-cross-origin-opener-policies\u2461"},{"id":"ref-for-cross-origin-opener-policies\u2462"}],"title":"1.1. Recommended readings"},{"refs":[{"id":"ref-for-cross-origin-opener-policies\u2463"}],"title":"2.2.2. Grouping of browsing contexts"}],"url":"https://html.spec.whatwg.org/C/#cross-origin-opener-policies"},
"2a9c82c5": {"dfnID":"2a9c82c5","dfnText":"cross-origin isolation mode","external":true,"refSections":[{"refs":[{"id":"ref-for-bcg-cross-origin-isolation"}],"title":"2.1.1. Cross-origin-opener-policies"},{"refs":[{"id":"ref-for-bcg-cross-origin-isolation\u2460"}],"title":"2.2.2. Grouping of browsing contexts"},{"refs":[{"id":"ref-for-bcg-cross-origin-isolation\u2461"},{"id":"ref-for-bcg-cross-origin-isolation\u2462"},{"id":"ref-for-bcg-cross-origin-isolation\u2463"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation"},
"2aaa937f": {"dfnID":"2aaa937f","dfnText":"cross-origin resource policy check","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-origin-resource-policy-check"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check"},
"2f018f5f": {"dfnID":"2f018f5f","dfnText":"create a new browsing context and document","external":true,"refSections":[{"refs":[{"id":"ref-for-creating-a-new-browsing-context"},{"id":"ref-for-creating-a-new-browsing-context\u2460"},{"id":"ref-for-creating-a-new-browsing-context\u2461"}],"title":"2.2.1. Browsing contexts"}],"url":"https://html.spec.whatwg.org/C/#creating-a-new-browsing-context"},
"3124aef9": {"dfnID":"3124aef9","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin"}],"title":"2.1.1.1. Browsing context group switches due to cross-origin opener policy"},{"refs":[{"id":"ref-for-concept-origin\u2460"}],"title":"2.1.2. Document Isolation Policies"},{"refs":[{"id":"ref-for-concept-origin\u2461"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-concept-origin\u2462"}],"title":"2.3.1. Shared document creation infrastructure"},{"refs":[{"id":"ref-for-concept-origin\u2463"},{"id":"ref-for-concept-origin\u2464"}],"title":"2.4. Agents and agent clusters"},{"refs":[{"id":"ref-for-concept-origin\u2465"},{"id":"ref-for-concept-origin\u2466"}],"title":"3.1. Requests"},{"refs":[{"id":"ref-for-concept-origin\u2467"},{"id":"ref-for-concept-origin\u2468"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#concept-origin"},
"33549c7a": {"dfnID":"33549c7a","dfnText":"is origin-keyed","external":true,"refSections":[{"refs":[{"id":"ref-for-is-origin-keyed"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/C/#is-origin-keyed"},
"33a77dff": {"dfnID":"33a77dff","dfnText":"map-exists","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"},{"id":"ref-for-map-exists\u2460"}],"title":"2.1.2.1. The headers"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"3a711be7": {"dfnID":"3a711be7","dfnText":"scheme","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-scheme"},{"id":"ref-for-concept-url-scheme\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"3e12e042": {"dfnID":"3e12e042","dfnText":"environment settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-environment-settings-object"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"3f2ca4de": {"dfnID":"3f2ca4de","dfnText":"current URL","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-current-url"}],"title":"3.1. Requests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-current-url"},
"3fa2961f": {"dfnID":"3fa2961f","dfnText":"agent cluster key","external":true,"refSections":[{"refs":[{"id":"ref-for-agent-cluster-key"},{"id":"ref-for-agent-cluster-key\u2460"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/C/#agent-cluster-key"},
"4338c067": {"dfnID":"4338c067","dfnText":"embedder policy value","external":true,"refSections":[{"refs":[{"id":"ref-for-embedder-policy-value"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-value"},
"5155c2d3": {"dfnID":"5155c2d3","dfnText":"non-secure context","external":true,"refSections":[{"refs":[{"id":"ref-for-non-secure-context"}],"title":"2.1.2.1. The headers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context"},
"5c66de35": {"dfnID":"5c66de35","dfnText":"get a structured field value","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-header-list-get-structured-header"},{"id":"ref-for-concept-header-list-get-structured-header\u2460"}],"title":"2.1.2.1. The headers"}],"url":"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header"},
"5ed8aeef": {"dfnID":"5ed8aeef","dfnText":"initialize a worker global scope's policy container","external":true,"refSections":[{"refs":[{"id":"ref-for-initialize-worker-policy-container"}],"title":"2.1.3. Policy containers"}],"url":"https://html.spec.whatwg.org/C/#initialize-worker-policy-container"},
"6dc08662": {"dfnID":"6dc08662","dfnText":"logical","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-origin-isolation-logical"}],"title":"2.1.1. Cross-origin-opener-policies"},{"refs":[{"id":"ref-for-cross-origin-isolation-logical\u2460"}],"title":"2.1.1.1. Browsing context group switches due to cross-origin opener policy"},{"refs":[{"id":"ref-for-cross-origin-isolation-logical\u2461"}],"title":"2.1.2. Document Isolation Policies"}],"url":"https://html.spec.whatwg.org/C/#cross-origin-isolation-logical"},
"76cf46eb": {"dfnID":"76cf46eb","dfnText":"obtain a similar-origin window agent","external":true,"refSections":[{"refs":[{"id":"ref-for-obtain-similar-origin-window-agent"}],"title":"2.3.1. Shared document creation infrastructure"},{"refs":[{"id":"ref-for-obtain-similar-origin-window-agent\u2460"},{"id":"ref-for-obtain-similar-origin-window-agent\u2461"},{"id":"ref-for-obtain-similar-origin-window-agent\u2462"},{"id":"ref-for-obtain-similar-origin-window-agent\u2463"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent"},
"76e370a7": {"dfnID":"76e370a7","dfnText":"request-includes-credentials","external":true,"refSections":[{"refs":[{"id":"ref-for-response-request-includes-credentials"},{"id":"ref-for-response-request-includes-credentials\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://fetch.spec.whatwg.org/#response-request-includes-credentials"},
"77a2dc1b": {"dfnID":"77a2dc1b","dfnText":"environment","external":true,"refSections":[{"refs":[{"id":"ref-for-environment"}],"title":"2.1.2.1. The headers"}],"url":"https://html.spec.whatwg.org/C/#environment"},
"7e8a44f1": {"dfnID":"7e8a44f1","dfnText":"cross-origin-resource-policy","external":true,"refSections":[{"refs":[{"id":"ref-for-http-cross-origin-resource-policy"},{"id":"ref-for-http-cross-origin-resource-policy\u2460"},{"id":"ref-for-http-cross-origin-resource-policy\u2461"},{"id":"ref-for-http-cross-origin-resource-policy\u2462"}],"title":"2.1.2. Document Isolation Policies"},{"refs":[{"id":"ref-for-http-cross-origin-resource-policy\u2463"},{"id":"ref-for-http-cross-origin-resource-policy\u2464"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy"},
"7ed9d314": {"dfnID":"7ed9d314","dfnText":"generate and queue a report","external":true,"refSections":[{"refs":[{"id":"ref-for-generate-and-queue-a-report"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://w3c.github.io/reporting/#generate-and-queue-a-report"},
"857d5516": {"dfnID":"857d5516","dfnText":"client","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-client"},{"id":"ref-for-concept-request-client\u2460"}],"title":"3.1. Requests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"8a30477b": {"dfnID":"8a30477b","dfnText":"global object","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-settings-object-global"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"},
"8af97c1e": {"dfnID":"8af97c1e","dfnText":"same-origin-plus-coep","external":true,"refSections":[{"refs":[{"id":"ref-for-coop-same-origin-plus-coep"}],"title":"2.1.1. Cross-origin-opener-policies"},{"refs":[{"id":"ref-for-coop-same-origin-plus-coep\u2460"}],"title":"2.1.1.1. Browsing context group switches due to cross-origin opener policy"}],"url":"https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep"},
"8cb360fb": {"dfnID":"8cb360fb","dfnText":"queue a cross-origin embedder policy corp violation report","external":true,"refSections":[{"refs":[{"id":"ref-for-queue-a-cross-origin-embedder-policy-corp-violation-report"},{"id":"ref-for-queue-a-cross-origin-embedder-policy-corp-violation-report\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report"},
"980528b0": {"dfnID":"980528b0","dfnText":"http-network-or-cache fetch","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-http-network-or-cache-fetch"}],"title":"3.3. HTTP-network-or-cache fetch"}],"url":"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch"},
"98cfc8b6": {"dfnID":"98cfc8b6","dfnText":"obtaining a similar-origin window agent","external":true,"refSections":[{"refs":[{"id":"ref-for-obtain-similar-origin-window-agent"}],"title":"2.3.1. Shared document creation infrastructure"},{"refs":[{"id":"ref-for-obtain-similar-origin-window-agent\u2460"},{"id":"ref-for-obtain-similar-origin-window-agent\u2461"},{"id":"ref-for-obtain-similar-origin-window-agent\u2462"},{"id":"ref-for-obtain-similar-origin-window-agent\u2463"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent"},
"9995e764": {"dfnID":"9995e764","dfnText":"coep-credentialless","external":true,"refSections":[{"refs":[{"id":"ref-for-coep-credentialless"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#coep-credentialless"},
"9c4c1e66": {"dfnID":"9c4c1e66","dfnText":"relevant settings object","external":true,"refSections":[{"refs":[{"id":"ref-for-relevant-settings-object"},{"id":"ref-for-relevant-settings-object\u2460"}],"title":"2.1.3. Policy containers"}],"url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"a2a30ba8": {"dfnID":"a2a30ba8","dfnText":"CORS protocol","external":true,"refSections":[{"refs":[{"id":"ref-for-cors-protocol"},{"id":"ref-for-cors-protocol\u2460"},{"id":"ref-for-cors-protocol\u2461"}],"title":"2.1.2. Document Isolation Policies"}],"url":"https://fetch.spec.whatwg.org/#cors-protocol"},
"a84c14c9": {"dfnID":"a84c14c9","dfnText":"document","external":true,"refSections":[{"refs":[{"id":"ref-for-clone-a-node-document"}],"title":"2.1.2.1. The headers"}],"url":"https://dom.spec.whatwg.org/#clone-a-node-document"},
"aab97826": {"dfnID":"aab97826","dfnText":"serialize a response URL for reporting","external":true,"refSections":[{"refs":[{"id":"ref-for-serialize-a-response-url-for-reporting"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://fetch.spec.whatwg.org/#serialize-a-response-url-for-reporting"},
"ae07036e": {"dfnID":"ae07036e","dfnText":"cross-origin resource policy internal check","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-origin-resource-policy-internal-check"},{"id":"ref-for-cross-origin-resource-policy-internal-check\u2460"},{"id":"ref-for-cross-origin-resource-policy-internal-check\u2461"},{"id":"ref-for-cross-origin-resource-policy-internal-check\u2462"},{"id":"ref-for-cross-origin-resource-policy-internal-check\u2463"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check"},
"b998573a": {"dfnID":"b998573a","dfnText":"embedder-policy-value-2","external":true,"refSections":[{"refs":[{"id":"ref-for-embedder-policy-value-2"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#embedder-policy-value-2"},
"bcg-coi-key": {"dfnID":"bcg-coi-key","dfnText":"agent cluster\ncross-origin isolation key","external":false,"refSections":[{"refs":[{"id":"ref-for-bcg-coi-key"}],"title":"2.1.1. Cross-origin-opener-policies"},{"refs":[{"id":"ref-for-bcg-coi-key\u2460"}],"title":"2.1.1.1. Browsing context group switches due to cross-origin opener policy"},{"refs":[{"id":"ref-for-bcg-coi-key\u2461"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-bcg-coi-key\u2462"}],"title":"2.4. Agents and agent clusters"}],"url":"#bcg-coi-key"},
"c2fcb960": {"dfnID":"c2fcb960","dfnText":"top-level browsing context","external":true,"refSections":[{"refs":[{"id":"ref-for-top-level-browsing-context"}],"title":"2.1.1. Cross-origin-opener-policies"}],"url":"https://html.spec.whatwg.org/C/#top-level-browsing-context"},
"c329eb66": {"dfnID":"c329eb66","dfnText":"redirect-tainted origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-tainted-origin"}],"title":"3.1. Requests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-tainted-origin"},
"c56b026c": {"dfnID":"c56b026c","dfnText":"obtain a browsing context to use for a navigation response","external":true,"refSections":[{"refs":[{"id":"ref-for-obtain-browsing-context-navigation"}],"title":"2.1.1.1. Browsing context group switches due to cross-origin opener policy"}],"url":"https://html.spec.whatwg.org/C/#obtain-browsing-context-navigation"},
"c8c92a09": {"dfnID":"c8c92a09","dfnText":"browsing context group","external":true,"refSections":[{"refs":[{"id":"ref-for-browsing-context-group"}],"title":"2.1.1. Cross-origin-opener-policies"},{"refs":[{"id":"ref-for-browsing-context-group\u2460"}],"title":"2.1.1.1. Browsing context group switches due to cross-origin opener policy"},{"refs":[{"id":"ref-for-browsing-context-group\u2461"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-browsing-context-group\u2462"},{"id":"ref-for-browsing-context-group\u2463"},{"id":"ref-for-browsing-context-group\u2464"}],"title":"2.2.2. Grouping of browsing contexts"},{"refs":[{"id":"ref-for-browsing-context-group\u2465"}],"title":"2.3.1. Shared document creation infrastructure"},{"refs":[{"id":"ref-for-browsing-context-group\u2466"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/C/#browsing-context-group"},
"cb98f71f": {"dfnID":"cb98f71f","dfnText":"mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-mode"}],"title":"3.1. Requests"}],"url":"https://fetch.spec.whatwg.org/#concept-request-mode"},
"ce1c0037": {"dfnID":"ce1c0037","dfnText":"create and initialize a document object","external":true,"refSections":[{"refs":[{"id":"ref-for-initialise-the-document-object"}],"title":"2.3.1. Shared document creation infrastructure"}],"url":"https://html.spec.whatwg.org/C/#initialise-the-document-object"},
"cfb6031b": {"dfnID":"cfb6031b","dfnText":"creating a policy container from a fetch response","external":true,"refSections":[{"refs":[{"id":"ref-for-creating-a-policy-container-from-a-fetch-response"}],"title":"2.1.3. Policy containers"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#creating-a-policy-container-from-a-fetch-response"},
"coi-agent-cluster-key": {"dfnID":"coi-agent-cluster-key","dfnText":"agent cluster cross-origin isolation\nkey","external":false,"refSections":[{"refs":[{"id":"ref-for-coi-agent-cluster-key"}],"title":"2.1.2. Document Isolation Policies"},{"refs":[{"id":"ref-for-coi-agent-cluster-key\u2460"},{"id":"ref-for-coi-agent-cluster-key\u2461"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-coi-agent-cluster-key\u2462"},{"id":"ref-for-coi-agent-cluster-key\u2463"}],"title":"2.2.2. Grouping of browsing contexts"},{"refs":[{"id":"ref-for-coi-agent-cluster-key\u2464"},{"id":"ref-for-coi-agent-cluster-key\u2465"},{"id":"ref-for-coi-agent-cluster-key\u2466"},{"id":"ref-for-coi-agent-cluster-key\u2467"}],"title":"2.4. Agents and agent clusters"}],"url":"#coi-agent-cluster-key"},
"corp-check-allowed": {"dfnID":"corp-check-allowed","dfnText":"allowed","external":false,"refSections":[{"refs":[{"id":"ref-for-corp-check-allowed"},{"id":"ref-for-corp-check-allowed\u2460"},{"id":"ref-for-corp-check-allowed\u2461"},{"id":"ref-for-corp-check-allowed\u2462"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#corp-check-allowed"},
"corp-check-blocked": {"dfnID":"corp-check-blocked","dfnText":"blocked","external":false,"refSections":[{"refs":[{"id":"ref-for-corp-check-blocked"},{"id":"ref-for-corp-check-blocked\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#corp-check-blocked"},
"corp-check-blocked-coep": {"dfnID":"corp-check-blocked-coep","dfnText":"blocked-by-coep","external":false,"refSections":[{"refs":[{"id":"ref-for-corp-check-blocked-coep"},{"id":"ref-for-corp-check-blocked-coep\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#corp-check-blocked-coep"},
"corp-check-blocked-coep-dip": {"dfnID":"corp-check-blocked-coep-dip","dfnText":"blocked-by-coep-and-dip","external":false,"refSections":[{"refs":[{"id":"ref-for-corp-check-blocked-coep-dip"},{"id":"ref-for-corp-check-blocked-coep-dip\u2460"},{"id":"ref-for-corp-check-blocked-coep-dip\u2461"},{"id":"ref-for-corp-check-blocked-coep-dip\u2462"},{"id":"ref-for-corp-check-blocked-coep-dip\u2463"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#corp-check-blocked-coep-dip"},
"corp-check-blocked-dip": {"dfnID":"corp-check-blocked-dip","dfnText":"blocked-by-dip","external":false,"refSections":[{"refs":[{"id":"ref-for-corp-check-blocked-dip"},{"id":"ref-for-corp-check-blocked-dip\u2460"},{"id":"ref-for-corp-check-blocked-dip\u2461"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#corp-check-blocked-dip"},
"corp-check-result": {"dfnID":"corp-check-result","dfnText":"cross-origin resource policy internal check result","external":false,"refSections":[{"refs":[{"id":"ref-for-corp-check-result"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#corp-check-result"},
"d5ce1200": {"dfnID":"d5ce1200","dfnText":"embedder-policy-report-only-value","external":true,"refSections":[{"refs":[{"id":"ref-for-embedder-policy-report-only-value"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#embedder-policy-report-only-value"},
"d8813cef": {"dfnID":"d8813cef","dfnText":"COEP","external":true,"refSections":[{"refs":[{"id":"ref-for-coep"},{"id":"ref-for-coep\u2460"},{"id":"ref-for-coep\u2461"},{"id":"ref-for-coep\u2462"}],"title":"1.1. Recommended readings"}],"url":"https://html.spec.whatwg.org/C/#coep"},
"dc248371": {"dfnID":"dc248371","dfnText":"owner set","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-WorkerGlobalScope-owner-set"},{"id":"ref-for-concept-WorkerGlobalScope-owner-set\u2460"},{"id":"ref-for-concept-WorkerGlobalScope-owner-set\u2461"}],"title":"2.1.3. Policy containers"}],"url":"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"},
"dcffbccd": {"dfnID":"dcffbccd","dfnText":"URL","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-concept-url\u2460"},{"id":"ref-for-concept-url\u2461"},{"id":"ref-for-concept-url\u2462"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"dip-header": {"dfnID":"dip-header","dfnText":"Document-Isolation-Policy","external":false,"refSections":[],"url":"#dip-header"},
"dip-isolate-and-credentialless": {"dfnID":"dip-isolate-and-credentialless","dfnText":"isolate-and-credentialless","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-isolate-and-credentialless"},{"id":"ref-for-dip-isolate-and-credentialless\u2460"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-isolate-and-credentialless\u2461"}],"title":"3.1. Requests"},{"refs":[{"id":"ref-for-dip-isolate-and-credentialless\u2462"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-isolate-and-credentialless"},
"dip-isolate-and-require-corp": {"dfnID":"dip-isolate-and-require-corp","dfnText":"isolate-and-require-corp","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-isolate-and-require-corp"},{"id":"ref-for-dip-isolate-and-require-corp\u2460"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-isolate-and-require-corp\u2461"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-isolate-and-require-corp"},
"dip-none": {"dfnID":"dip-none","dfnText":"none","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-none"},{"id":"ref-for-dip-none\u2460"},{"id":"ref-for-dip-none\u2461"}],"title":"2.1.2. Document Isolation Policies"},{"refs":[{"id":"ref-for-dip-none\u2462"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-none"},
"dip-report-only-endpoint": {"dfnID":"dip-report-only-endpoint","dfnText":"report-only reporting endpoint","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-report-only-endpoint"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-report-only-endpoint\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-report-only-endpoint"},
"dip-report-only-header": {"dfnID":"dip-report-only-header","dfnText":"Document-Isolation-Policy-Report-Only","external":false,"refSections":[],"url":"#dip-report-only-header"},
"dip-report-only-value": {"dfnID":"dip-report-only-value","dfnText":"report-only value","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-report-only-value"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-report-only-value\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-report-only-value"},
"dip-reporting-endpoint": {"dfnID":"dip-reporting-endpoint","dfnText":"reporting endpoint","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-reporting-endpoint"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-reporting-endpoint\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-reporting-endpoint"},
"dip-struct": {"dfnID":"dip-struct","dfnText":"document isolation policy","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-struct"}],"title":"2.1.2. Document Isolation Policies"},{"refs":[{"id":"ref-for-dip-struct\u2460"},{"id":"ref-for-dip-struct\u2461"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-struct\u2462"},{"id":"ref-for-dip-struct\u2463"},{"id":"ref-for-dip-struct\u2464"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-dip-struct\u2465"}],"title":"2.2.2. Grouping of browsing contexts"}],"url":"#dip-struct"},
"dip-struct-value": {"dfnID":"dip-struct-value","dfnText":"value","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-struct-value"}],"title":"2.1.2. Document Isolation Policies"},{"refs":[{"id":"ref-for-dip-struct-value\u2460"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-struct-value\u2461"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-struct-value"},
"dip-value": {"dfnID":"dip-value","dfnText":"document isolation policy value","external":false,"refSections":[{"refs":[{"id":"ref-for-dip-value"},{"id":"ref-for-dip-value\u2460"}],"title":"2.1.2. Document Isolation Policies"},{"refs":[{"id":"ref-for-dip-value\u2461"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-dip-value\u2462"}],"title":"3.1. Requests"},{"refs":[{"id":"ref-for-dip-value\u2463"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#dip-value"},
"document-isolation-policy-allows-credentials": {"dfnID":"document-isolation-policy-allows-credentials","dfnText":"Document-Isolation-Policy allows credentials","external":false,"refSections":[{"refs":[{"id":"ref-for-document-isolation-policy-allows-credentials"}],"title":"3.3. HTTP-network-or-cache fetch"}],"url":"#document-isolation-policy-allows-credentials"},
"e2eac3f1": {"dfnID":"e2eac3f1","dfnText":"list-size","external":true,"refSections":[{"refs":[{"id":"ref-for-list-size"}],"title":"2.1.3. Policy containers"}],"url":"https://infra.spec.whatwg.org/#list-size"},
"e3892898": {"dfnID":"e3892898","dfnText":"COOP","external":true,"refSections":[{"refs":[{"id":"ref-for-cross-origin-opener-policies"},{"id":"ref-for-cross-origin-opener-policies\u2460"},{"id":"ref-for-cross-origin-opener-policies\u2461"},{"id":"ref-for-cross-origin-opener-policies\u2462"}],"title":"1.1. Recommended readings"},{"refs":[{"id":"ref-for-cross-origin-opener-policies\u2463"}],"title":"2.2.2. Grouping of browsing contexts"}],"url":"https://html.spec.whatwg.org/C/#cross-origin-opener-policies"},
"ec8f27f1": {"dfnID":"ec8f27f1","dfnText":"coep-require-corp","external":true,"refSections":[{"refs":[{"id":"ref-for-coep-require-corp"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#coep-require-corp"},
"ee4df7df": {"dfnID":"ee4df7df","dfnText":"loading web pages supporting concepts","external":true,"refSections":[{"refs":[{"id":"ref-for-loading-web-pages-supporting-concepts"}],"title":"2.1.2. Document Isolation Policies"}],"url":"https://html.spec.whatwg.org/C/#loading-web-pages-supporting-concepts"},
"ee7bba09": {"dfnID":"ee7bba09","dfnText":"response","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response"}],"title":"2.1.2.1. The headers"},{"refs":[{"id":"ref-for-concept-response\u2460"},{"id":"ref-for-concept-response\u2461"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://fetch.spec.whatwg.org/#concept-response"},
"f26905b5": {"dfnID":"f26905b5","dfnText":"same origin","external":true,"refSections":[{"refs":[{"id":"ref-for-same-origin"}],"title":"3.1. Requests"},{"refs":[{"id":"ref-for-same-origin\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"https://html.spec.whatwg.org/C/#same-origin"},
"f58ae318": {"dfnID":"f58ae318","dfnText":"Integration with the JavaScript agent cluster formalism","external":true,"refSections":[{"refs":[{"id":"ref-for-integration-with-the-javascript-agent-cluster-formalism"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/C/#integration-with-the-javascript-agent-cluster-formalism"},
"f7b00a8b": {"dfnID":"f7b00a8b","dfnText":"header list","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-header-list"},{"id":"ref-for-concept-response-header-list\u2460"}],"title":"2.1.2.1. The headers"}],"url":"https://fetch.spec.whatwg.org/#concept-response-header-list"},
"f9433a40": {"dfnID":"f9433a40","dfnText":"structured headers","external":true,"refSections":[{"refs":[{"id":"ref-for-specify"}],"title":"2.1.2.1. The headers"}],"url":"https://httpwg.org/specs/rfc8941.html#specify"},
"fa5c4242": {"dfnID":"fa5c4242","dfnText":"agent cluster","external":true,"refSections":[{"refs":[{"id":"ref-for-sec-agent-clusters"},{"id":"ref-for-sec-agent-clusters\u2460"},{"id":"ref-for-sec-agent-clusters\u2461"},{"id":"ref-for-sec-agent-clusters\u2462"}],"title":"2.1.2. Document Isolation Policies"}],"url":"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters"},
"fb9bb722": {"dfnID":"fb9bb722","dfnText":"site","external":true,"refSections":[{"refs":[{"id":"ref-for-site"}],"title":"2.4. Agents and agent clusters"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#site"},
"fc5a3214": {"dfnID":"fc5a3214","dfnText":"parameters","external":true,"refSections":[{"refs":[{"id":"ref-for-parameters"}],"title":"2.1.2.1. The headers"}],"url":"https://mimesniff.spec.whatwg.org/#parameters"},
"obtain-coi-key": {"dfnID":"obtain-coi-key","dfnText":"obtain a cross-origin agent cluster isolation\nkey","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-coi-key"}],"title":"2.1.3. Policy containers"}],"url":"#obtain-coi-key"},
"obtain-dip": {"dfnID":"obtain-dip","dfnText":"obtain a document isolation policy","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-dip"}],"title":"2.1.3. Policy containers"}],"url":"#obtain-dip"},
"policy-container-coi-key": {"dfnID":"policy-container-coi-key","dfnText":"agent cluster cross-origin isolation\nkey","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-container-coi-key"},{"id":"ref-for-policy-container-coi-key\u2460"},{"id":"ref-for-policy-container-coi-key\u2461"},{"id":"ref-for-policy-container-coi-key\u2462"},{"id":"ref-for-policy-container-coi-key\u2463"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-policy-container-coi-key\u2464"}],"title":"2.2.1. Browsing contexts"},{"refs":[{"id":"ref-for-policy-container-coi-key\u2465"}],"title":"2.2.2. Grouping of browsing contexts"},{"refs":[{"id":"ref-for-policy-container-coi-key\u2466"}],"title":"2.3.1. Shared document creation infrastructure"}],"url":"#policy-container-coi-key"},
"policy-container-dip": {"dfnID":"policy-container-dip","dfnText":"document isolation policy","external":false,"refSections":[{"refs":[{"id":"ref-for-policy-container-dip"},{"id":"ref-for-policy-container-dip\u2460"},{"id":"ref-for-policy-container-dip\u2461"},{"id":"ref-for-policy-container-dip\u2462"},{"id":"ref-for-policy-container-dip\u2463"},{"id":"ref-for-policy-container-dip\u2464"}],"title":"2.1.3. Policy containers"},{"refs":[{"id":"ref-for-policy-container-dip\u2465"}],"title":"3.1. Requests"},{"refs":[{"id":"ref-for-policy-container-dip\u2466"},{"id":"ref-for-policy-container-dip\u2467"},{"id":"ref-for-policy-container-dip\u2468"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#policy-container-dip"},
"queue-a-document-isolation-policy-corp-violation-report": {"dfnID":"queue-a-document-isolation-policy-corp-violation-report","dfnText":"queue a document isolation policy CORP violation report","external":false,"refSections":[{"refs":[{"id":"ref-for-queue-a-document-isolation-policy-corp-violation-report"},{"id":"ref-for-queue-a-document-isolation-policy-corp-violation-report\u2460"}],"title":"3.2. 'Cross-Origin-Resource-Policy' header"}],"url":"#queue-a-document-isolation-policy-corp-violation-report"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#bcg-coi-key": {"displayText":"bcg-coi-key","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"bcg-coi-key","type":"dfn","url":"#bcg-coi-key"},
"#coi-agent-cluster-key": {"displayText":"coi-agent-cluster-key","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"coi-agent-cluster-key","type":"dfn","url":"#coi-agent-cluster-key"},
"#corp-check-allowed": {"displayText":"corp-check-allowed","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"corp-check-allowed","type":"dfn","url":"#corp-check-allowed"},
"#corp-check-blocked": {"displayText":"corp-check-blocked","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"corp-check-blocked","type":"dfn","url":"#corp-check-blocked"},
"#corp-check-blocked-coep": {"displayText":"corp-check-blocked-coep","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"corp-check-blocked-coep","type":"dfn","url":"#corp-check-blocked-coep"},
"#corp-check-blocked-coep-dip": {"displayText":"corp-check-blocked-coep-dip","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"corp-check-blocked-coep-dip","type":"dfn","url":"#corp-check-blocked-coep-dip"},
"#corp-check-blocked-dip": {"displayText":"corp-check-blocked-dip","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"corp-check-blocked-dip","type":"dfn","url":"#corp-check-blocked-dip"},
"#corp-check-result": {"displayText":"corp-check-result","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"corp-check-result","type":"dfn","url":"#corp-check-result"},
"#dip-isolate-and-credentialless": {"displayText":"dip-isolate-and-credentialless","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-isolate-and-credentialless","type":"dfn","url":"#dip-isolate-and-credentialless"},
"#dip-isolate-and-require-corp": {"displayText":"dip-isolate-and-require-corp","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-isolate-and-require-corp","type":"dfn","url":"#dip-isolate-and-require-corp"},
"#dip-none": {"displayText":"dip-none","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-none","type":"dfn","url":"#dip-none"},
"#dip-report-only-endpoint": {"displayText":"dip-report-only-endpoint","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-report-only-endpoint","type":"dfn","url":"#dip-report-only-endpoint"},
"#dip-report-only-value": {"displayText":"dip-report-only-value","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-report-only-value","type":"dfn","url":"#dip-report-only-value"},
"#dip-reporting-endpoint": {"displayText":"dip-reporting-endpoint","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-reporting-endpoint","type":"dfn","url":"#dip-reporting-endpoint"},
"#dip-struct": {"displayText":"dip-struct","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-struct","type":"dfn","url":"#dip-struct"},
"#dip-struct-value": {"displayText":"dip-struct-value","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-struct-value","type":"dfn","url":"#dip-struct-value"},
"#dip-value": {"displayText":"dip-value","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"dip-value","type":"dfn","url":"#dip-value"},
"#document-isolation-policy-allows-credentials": {"displayText":"document-isolation-policy allows credentials","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"document-isolation-policy allows credentials","type":"dfn","url":"#document-isolation-policy-allows-credentials"},
"#obtain-coi-key": {"displayText":"obtain-coi-key","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"obtain-coi-key","type":"dfn","url":"#obtain-coi-key"},
"#obtain-dip": {"displayText":"obtain-dip","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"obtain-dip","type":"dfn","url":"#obtain-dip"},
"#policy-container-coi-key": {"displayText":"policy-container-coi-key","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"policy-container-coi-key","type":"dfn","url":"#policy-container-coi-key"},
"#policy-container-dip": {"displayText":"policy-container-dip","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"policy-container-dip","type":"dfn","url":"#policy-container-dip"},
"#queue-a-document-isolation-policy-corp-violation-report": {"displayText":"queue a document isolation policy corp violation report","export":true,"for_":[],"level":"1","normative":true,"shortname":"coop-restrict-properties","spec":"coop-restrict-properties-1","status":"local","text":"queue a document isolation policy corp violation report","type":"dfn","url":"#queue-a-document-isolation-policy-corp-violation-report"},
"4fcd5676_https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent": {"displayText":"obtain a similar-origin window agent","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"obtain a similar-origin window agent","type":"dfn","url":"https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent"},
"776ed7cb_https://html.spec.whatwg.org/C/#cross-origin-opener-policies": {"displayText":"COOP","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"coop","type":"dfn","url":"https://html.spec.whatwg.org/C/#cross-origin-opener-policies"},
"fb08834f_https://html.spec.whatwg.org/C/#coep": {"displayText":"COEP","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"coep","type":"dfn","url":"https://html.spec.whatwg.org/C/#coep"},
"https://dom.spec.whatwg.org/#clone-a-node-document": {"displayText":"document","export":true,"for_":["clone a node"],"level":"1","normative":true,"shortname":"dom","spec":"dom","status":"current","text":"document","type":"dfn","url":"https://dom.spec.whatwg.org/#clone-a-node-document"},
"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header": {"displayText":"get a structured field value","export":true,"for_":["header list"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"get a structured field value","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header"},
"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch": {"displayText":"http-network-or-cache fetch","export":true,"for_":[],"level":"","normative":true,"shortname":"fetch","spec":"fetch","status":"anchor-block","text":"http-network-or-cache fetch","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch"},
"https://fetch.spec.whatwg.org/#concept-request-client": {"displayText":"client","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"client","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-client"},
"https://fetch.spec.whatwg.org/#concept-request-current-url": {"displayText":"current URL","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"current url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-current-url"},
"https://fetch.spec.whatwg.org/#concept-request-mode": {"displayText":"mode","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-mode"},
"https://fetch.spec.whatwg.org/#concept-request-request": {"displayText":"request","export":true,"for_":["Request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"request","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-request"},
"https://fetch.spec.whatwg.org/#concept-request-tainted-origin": {"displayText":"redirect-tainted origin","export":true,"for_":[],"level":"","normative":true,"shortname":"fetch","spec":"fetch","status":"anchor-block","text":"redirect-tainted origin","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-tainted-origin"},
"https://fetch.spec.whatwg.org/#concept-response": {"displayText":"response","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"response","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response"},
"https://fetch.spec.whatwg.org/#concept-response-header-list": {"displayText":"header list","export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"header list","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-header-list"},
"https://fetch.spec.whatwg.org/#cors-protocol": {"displayText":"CORS protocol","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"cors protocol","type":"dfn","url":"https://fetch.spec.whatwg.org/#cors-protocol"},
"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check": {"displayText":"cross-origin resource policy check","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"cross-origin resource policy check","type":"dfn","url":"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-check"},
"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check": {"displayText":"cross-origin resource policy internal check","export":true,"for_":[],"level":"","normative":true,"shortname":"fetch","spec":"fetch","status":"anchor-block","text":"cross-origin resource policy internal check","type":"dfn","url":"https://fetch.spec.whatwg.org/#cross-origin-resource-policy-internal-check"},
"https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy": {"displayText":"cross-origin-resource-policy","export":true,"for_":[],"level":"","normative":true,"shortname":"fetch","spec":"fetch","status":"anchor-block","text":"cross-origin-resource-policy","type":"dfn","url":"https://fetch.spec.whatwg.org/#http-cross-origin-resource-policy"},
"https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report": {"displayText":"queue a cross-origin embedder policy corp violation report","export":true,"for_":[],"level":"","normative":true,"shortname":"fetch","spec":"fetch","status":"anchor-block","text":"queue a cross-origin embedder policy corp violation report","type":"dfn","url":"https://fetch.spec.whatwg.org/#queue-a-cross-origin-embedder-policy-corp-violation-report"},
"https://fetch.spec.whatwg.org/#response-request-includes-credentials": {"displayText":"request-includes-credentials","export":true,"for_":[],"level":"","normative":true,"shortname":"fetch","spec":"fetch","status":"anchor-block","text":"request-includes-credentials","type":"dfn","url":"https://fetch.spec.whatwg.org/#response-request-includes-credentials"},
"https://fetch.spec.whatwg.org/#serialize-a-response-url-for-reporting": {"displayText":"serialize a response URL for reporting","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"serialize a response url for reporting","type":"dfn","url":"https://fetch.spec.whatwg.org/#serialize-a-response-url-for-reporting"},
"https://html.spec.whatwg.org/C/#agent-cluster-key": {"displayText":"agent cluster key","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"agent cluster key","type":"dfn","url":"https://html.spec.whatwg.org/C/#agent-cluster-key"},
"https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation": {"displayText":"cross-origin isolation mode","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"cross-origin isolation mode","type":"dfn","url":"https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation"},
"https://html.spec.whatwg.org/C/#browsing-context-group": {"displayText":"browsing context group","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"browsing context group","type":"dfn","url":"https://html.spec.whatwg.org/C/#browsing-context-group"},
"https://html.spec.whatwg.org/C/#coep": {"displayText":"Cross-Origin-Embedder-Policy","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"cross-origin-embedder-policy","type":"dfn","url":"https://html.spec.whatwg.org/C/#coep"},
"https://html.spec.whatwg.org/C/#coep-credentialless": {"displayText":"coep-credentialless","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"coep-credentialless","type":"dfn","url":"https://html.spec.whatwg.org/C/#coep-credentialless"},
"https://html.spec.whatwg.org/C/#coep-require-corp": {"displayText":"coep-require-corp","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"coep-require-corp","type":"dfn","url":"https://html.spec.whatwg.org/C/#coep-require-corp"},
"https://html.spec.whatwg.org/C/#coep-unsafe-none": {"displayText":"coep-unsafe-none","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"coep-unsafe-none","type":"dfn","url":"https://html.spec.whatwg.org/C/#coep-unsafe-none"},
"https://html.spec.whatwg.org/C/#concept-origin": {"displayText":"origin","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/C/#concept-origin"},
"https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep": {"displayText":"same-origin-plus-coep","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"same-origin-plus-coep","type":"dfn","url":"https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep"},
"https://html.spec.whatwg.org/C/#creating-a-new-browsing-context": {"displayText":"create a new browsing context and document","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"create a new browsing context and document","type":"dfn","url":"https://html.spec.whatwg.org/C/#creating-a-new-browsing-context"},
"https://html.spec.whatwg.org/C/#cross-origin-isolation-concrete": {"displayText":"concrete","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"concrete","type":"dfn","url":"https://html.spec.whatwg.org/C/#cross-origin-isolation-concrete"},
"https://html.spec.whatwg.org/C/#cross-origin-isolation-logical": {"displayText":"logical","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"logical","type":"dfn","url":"https://html.spec.whatwg.org/C/#cross-origin-isolation-logical"},
"https://html.spec.whatwg.org/C/#cross-origin-opener-policies": {"displayText":"Cross-Origin-Opener-Policy","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"cross-origin-opener-policy","type":"dfn","url":"https://html.spec.whatwg.org/C/#cross-origin-opener-policies"},
"https://html.spec.whatwg.org/C/#embedder-policy-report-only-value": {"displayText":"embedder-policy-report-only-value","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"embedder-policy-report-only-value","type":"dfn","url":"https://html.spec.whatwg.org/C/#embedder-policy-report-only-value"},
"https://html.spec.whatwg.org/C/#embedder-policy-value-2": {"displayText":"embedder-policy-value-2","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"embedder-policy-value-2","type":"dfn","url":"https://html.spec.whatwg.org/C/#embedder-policy-value-2"},
"https://html.spec.whatwg.org/C/#environment": {"displayText":"environment","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"environment","type":"dfn","url":"https://html.spec.whatwg.org/C/#environment"},
"https://html.spec.whatwg.org/C/#initialise-the-document-object": {"displayText":"create and initialize a document object","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"create and initialize a document object","type":"dfn","url":"https://html.spec.whatwg.org/C/#initialise-the-document-object"},
"https://html.spec.whatwg.org/C/#initialize-worker-policy-container": {"displayText":"initialize a worker global scope's policy container","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"initialize a worker global scope's policy container","type":"dfn","url":"https://html.spec.whatwg.org/C/#initialize-worker-policy-container"},
"https://html.spec.whatwg.org/C/#integration-with-the-javascript-agent-cluster-formalism": {"displayText":"Integration with the JavaScript agent cluster formalism","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"integration with the javascript agent cluster formalism","type":"dfn","url":"https://html.spec.whatwg.org/C/#integration-with-the-javascript-agent-cluster-formalism"},
"https://html.spec.whatwg.org/C/#is-origin-keyed": {"displayText":"is origin-keyed","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"is origin-keyed","type":"dfn","url":"https://html.spec.whatwg.org/C/#is-origin-keyed"},
"https://html.spec.whatwg.org/C/#loading-web-pages-supporting-concepts": {"displayText":"loading web pages supporting concepts","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"loading web pages supporting concepts","type":"dfn","url":"https://html.spec.whatwg.org/C/#loading-web-pages-supporting-concepts"},
"https://html.spec.whatwg.org/C/#obtain-browsing-context-navigation": {"displayText":"obtain a browsing context to use for a navigation response","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"obtain a browsing context to use for a navigation response","type":"dfn","url":"https://html.spec.whatwg.org/C/#obtain-browsing-context-navigation"},
"https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent": {"displayText":"obtaining a similar-origin window agent","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"obtaining a similar-origin window agent","type":"dfn","url":"https://html.spec.whatwg.org/C/#obtain-similar-origin-window-agent"},
"https://html.spec.whatwg.org/C/#policy-container": {"displayText":"policy container","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"policy container","type":"dfn","url":"https://html.spec.whatwg.org/C/#policy-container"},
"https://html.spec.whatwg.org/C/#same-origin": {"displayText":"same origin","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"same origin","type":"dfn","url":"https://html.spec.whatwg.org/C/#same-origin"},
"https://html.spec.whatwg.org/C/#top-level-browsing-context": {"displayText":"top-level browsing context","export":true,"for_":[],"level":"","normative":true,"shortname":"html","spec":"html","status":"anchor-block","text":"top-level browsing context","type":"dfn","url":"https://html.spec.whatwg.org/C/#top-level-browsing-context"},
"https://html.spec.whatwg.org/multipage/browsers.html#clone-a-policy-container": {"displayText":"clone a policy container","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"clone a policy container","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#clone-a-policy-container"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple": {"displayText":"tuple origin","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"tuple origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple"},
"https://html.spec.whatwg.org/multipage/browsers.html#creating-a-policy-container-from-a-fetch-response": {"displayText":"creating a policy container from a fetch response","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"creating a policy container from a fetch response","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#creating-a-policy-container-from-a-fetch-response"},
"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-value": {"displayText":"embedder policy value","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"embedder policy value","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#embedder-policy-value"},
"https://html.spec.whatwg.org/multipage/browsers.html#schemelessly-same-site": {"displayText":"schemelessly same site","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"schemelessly same site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#schemelessly-same-site"},
"https://html.spec.whatwg.org/multipage/browsers.html#site": {"displayText":"site","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#site"},
"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global": {"displayText":"global object","export":true,"for_":["environment settings object"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"global object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global"},
"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object": {"displayText":"environment settings object","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"environment settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object"},
"https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context": {"displayText":"non-secure context","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"non-secure context","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#non-secure-context"},
"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object": {"displayText":"relevant settings object","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"relevant settings object","type":"dfn","url":"https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object"},
"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set": {"displayText":"owner set","export":true,"for_":["WorkerGlobalScope"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"owner set","type":"dfn","url":"https://html.spec.whatwg.org/multipage/workers.html#concept-WorkerGlobalScope-owner-set"},
"https://httpwg.org/specs/rfc8941.html#specify": {"displayText":"structured headers","export":true,"for_":[],"level":"","normative":true,"shortname":"structured-fields","spec":"structured-fields","status":"anchor-block","text":"structured headers","type":"dfn","url":"https://httpwg.org/specs/rfc8941.html#specify"},
"https://httpwg.org/specs/rfc8941.html#token": {"displayText":"token","export":true,"for_":[],"level":"","normative":true,"shortname":"structured-fields","spec":"structured-fields","status":"anchor-block","text":"token","type":"dfn","url":"https://httpwg.org/specs/rfc8941.html#token"},
"https://infra.spec.whatwg.org/#list-size": {"displayText":"list-size","export":true,"for_":[],"level":"","normative":true,"shortname":"infra","spec":"infra","status":"anchor-block","text":"list-size","type":"dfn","url":"https://infra.spec.whatwg.org/#list-size"},
"https://infra.spec.whatwg.org/#map-exists": {"displayText":"map-exists","export":true,"for_":[],"level":"","normative":true,"shortname":"infra","spec":"infra","status":"anchor-block","text":"map-exists","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#tuple": {"displayText":"tuple","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"tuple","type":"dfn","url":"https://infra.spec.whatwg.org/#tuple"},
"https://mimesniff.spec.whatwg.org/#parameters": {"displayText":"parameters","export":true,"for_":["MIME type"],"level":"1","normative":true,"shortname":"mimesniff","spec":"mimesniff","status":"current","text":"parameters","type":"dfn","url":"https://mimesniff.spec.whatwg.org/#parameters"},
"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters": {"displayText":"agent cluster","export":true,"for_":["ECMAScript"],"level":"1","normative":true,"shortname":"ecmascript","spec":"ecmascript","status":"current","text":"agent cluster","type":"dfn","url":"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters"},
"https://url.spec.whatwg.org/#concept-url": {"displayText":"URL","export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url"},
"https://url.spec.whatwg.org/#concept-url-scheme": {"displayText":"scheme","export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"scheme","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-scheme"},
"https://url.spec.whatwg.org/#valid-url-string": {"displayText":"valid URL string","export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"valid url string","type":"dfn","url":"https://url.spec.whatwg.org/#valid-url-string"},
"https://w3c.github.io/reporting/#generate-and-queue-a-report": {"displayText":"generate and queue a report","export":true,"for_":[],"level":"1","normative":true,"shortname":"reporting","spec":"reporting-1","status":"current","text":"generate and queue a report","type":"dfn","url":"https://w3c.github.io/reporting/#generate-and-queue-a-report"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>